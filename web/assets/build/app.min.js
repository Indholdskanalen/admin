/**
 * @name Aroskanalen
 * @version v4.0.0
 * @link https://github.com/aroskanalen/admin
 */
angular.module("ikApp",["ngRoute","ngAnimate","angularFileUpload","colorpicker.module","datetimePicker","ngLocale","taiPlaceholder","ngModal","angular-dnd","720kb.tooltips","busModule","itkControlPanel","itkScreenTemplatePickerWidget","itkTextWidget","itkTextAreaWidget","itkNumberWidget","itkChannelPickerWidget","itkSharedChannelPickerWidget","itkChannelRemoverWidget","itkRegionPreviewWidget","itkDateComponent","itkDigitalClockComponent"],function(){}).config(["$sceDelegateProvider",function(e){"use strict";e.resourceUrlWhitelist(["self","**"])}]),angular.module("ikApp").config(["$routeProvider",function(e){"use strict";e.when("/",{redirectTo:"/channel-overview"}).when("/admin-sharing",{controller:"AdminSharingController",templateUrl:"app/pages/adminSharing/admin-sharing.html?"+window.config.version}).when("/admin-templates",{controller:"AdminTemplatesController",templateUrl:"app/pages/adminTemplates/admin-templates.html?"+window.config.version}).when("/channel-overview",{controller:"ChannelOverviewController",templateUrl:"app/pages/channelOverview/channel-overview.html?"+window.config.version}).when("/slide-overview",{controller:"SlideOverviewController",templateUrl:"app/pages/slideOverview/slide-overview.html?"+window.config.version}).when("/screen-overview",{controller:"ScreenOverviewController",templateUrl:"app/pages/screenOverview/screen-overview.html?"+window.config.version}).when("/media-overview",{controller:"MediaOverviewController",templateUrl:"app/pages/mediaOverview/media-overview.html?"+window.config.version}).when("/shared-channel-overview",{controller:"SharedChannelOverviewController",templateUrl:"app/pages/sharedChannelOverview/shared-channel-overview.html?"+window.config.version}).when("/screen",{controller:"ScreenController",templateUrl:"app/pages/screen/screen.html?"+window.config.version}).when("/screen/:id",{controller:"ScreenController",templateUrl:"app/pages/screen/screen.html?"+window.config.version}).when("/slide",{controller:"SlideController",templateUrl:"app/pages/slide/slide.html?"+window.config.version}).when("/slide/:id",{controller:"SlideController",templateUrl:"app/pages/slide/slide.html?"+window.config.version}).when("/shared-channel/:id/:index",{controller:"SharedChannelController",templateUrl:"app/pages/sharedChannel/shared-channel.html?"+window.config.version}).when("/channel",{controller:"ChannelController",templateUrl:"app/pages/channel/channel.html?"+window.config.version}).when("/channel/:id",{controller:"ChannelController",templateUrl:"app/pages/channel/channel.html?"+window.config.version}).when("/media/upload",{controller:"MediaUploadController",templateUrl:"app/pages/mediaUpload/media-upload.html?"+window.config.version}).when("/media/:id",{controller:"MediaEditController",templateUrl:"app/pages/mediaEdit/media-edit.html?"+window.config.version}).otherwise({template:""})}]),angular.module("ikApp").controller("AdminTemplatesController",["busService","templateFactory","$scope",function(e,n,t){"use strict";t.saving=!1,t.screenTemplates=[],t.slideTemplates=[],t.enabledScreenTemplates=[],t.enabledSlideTemplates=[],n.getAllScreenTemplates().then(function(e){t.screenTemplates=e;for(var n=[],r=0;r<e.length;r++)e[r].enabled&&n.push(e[r]);t.enabledScreenTemplates=n},function(n){e.$emit("log.error",{cause:n,msg:"Hentning af tilgængelige templates fejlede."})}),n.getAllSlideTemplates().then(function(e){t.slideTemplates=e;for(var n=[],r=0;r<e.length;r++)e[r].enabled&&n.push(e[r]);t.enabledSlideTemplates=n},function(n){e.$emit("log.error",{cause:n,msg:"Hentning af tilgængelige templates fejlede."})}),t.save=function(){t.saving=!0,n.saveEnabledTemplates(t.enabledScreenTemplates,t.enabledSlideTemplates).then(function(){e.$emit("log.info",{msg:"Template valg blev gemt",timeout:3e3}),t.saving=!1},function(n){e.$emit("log.error",{cause:n,msg:"Template valg blev ikke gemt"}),t.saving=!1})}}]),angular.module("ikApp").controller("AdminSharingController",["busService","sharedChannelFactory","$scope",function(e,n,t){"use strict";t.saving=!1,t.availableIndexes=[],n.getAvailableIndexes().then(function(e){e.forEach(function(e){"shared"===e.tag&&t.availableIndexes.push(e)})},function(n){e.$emit("log.error",{cause:n,msg:"Hentning af tilgængelige delingsindeks fejlede."})}),t.chosenIndexes=[],n.getSharingIndexes().then(function(e){t.chosenIndexes=e},function(n){e.$emit("log.error",{cause:n,msg:"Hentning af valgte delingsindeks fejlede."})}),t.save=function(){t.saving=!0,n.saveSharingIndexes(t.chosenIndexes).then(function(){e.$emit("log.info",{msg:"Delingsindeks gemt",timeout:3e3}),t.saving=!1},function(n){e.$emit("log.error",{cause:n,msg:"Delingsindeks blev ikke gemt."}),t.saving=!1})}}]),angular.module("ikApp").controller("ChannelController",["$scope","$location","$routeParams","$timeout","$filter","channelFactory","slideFactory","busService",function(e,n,t,r,i,o,a,l){"use strict";function s(n){e.step=n,e.templatePath="/app/pages/channel/channel-step"+e.step+".html?"+window.config.version}function c(){t.id?null===t.id||void 0===t.id||""===t.id?n.path("/channel"):o.getEditChannel(t.id).then(function(t){e.channel=t,e.channel.status="edit-channel",e.channel==={}&&n.path("/channel"),s(2)},function(e){n.path("/channel-overview"),l.$emit("log.error",{cause:e,msg:"Hentning af valgt kanal med id:"+t.id+" fejlede"})}):(e.channel=o.emptyChannel(),s(1))}function d(n){return!!e.channel&&""!==e.channel[n]}function u(e,n,t){var r=e[n];e[n]=e[t],e[t]=r}function p(e){for(var n,t,r=e.length;0!==r;)t=Math.floor(Math.random()*r),r-=1,n=e[r],e[r]=e[t],e[t]=n;return e}e.steps=3,e.slides=[],e.channel={},e.days=[{id:1,name:"Mandag"},{id:2,name:"Tirsdag"},{id:3,name:"Onsdag"},{id:4,name:"Torsdag"},{id:5,name:"Fredag"},{id:6,name:"Lørdag"},{id:0,name:"Søndag"}],a.getSlides().then(function(n){e.slides=n},function(e){l.$emit("log.error",{cause:e,msg:"Hentning af slides fejlede"})}),e.editor={slideOverviewEditor:!1,toggleSlideOverviewEditor:function(){l.$emit("bodyService.toggleClass","is-locked"),e.editor.slideOverviewEditor=!e.editor.slideOverviewEditor}},e.$on("slideOverview.clickSlide",function(n,t){e.toggleSlide(t)}),c(),e.submitStep=function(){e.step===e.steps?(e.disableSubmitButton=!0,o.saveChannel().then(function(){l.$emit("log.info",{msg:"Kanal gemt.",timeout:3e3}),r(function(){n.path("/channel-overview")},1e3)},function(n){l.$emit("log.error",{cause:n,msg:"Gem af kanal fejlede."}),e.disableSubmitButton=!1})):s(e.step+1)},e.setOrientation=function(n){e.channel.orientation=n},e.slideSelected=function(n){var t=!1;return e.channel.slides.forEach(function(e){n===e.id&&(t=!0)}),t},e.validation={titleSet:function(){return d("title")},orientationSet:function(){return d("orientation")}},e.toggleSlide=function(n){var t=null;e.channel.slides.forEach(function(e,r){n.id===e.id&&(t=r)}),null!==t?e.channel.slides.splice(t,1):e.channel.slides.push(n)},e.slideScheduledNow=function(e){if(!e.published)return!1;var n=new Date;return n=parseInt(n.getTime()/1e3),!(e.hasOwnProperty("schedule_from")&&n<e.schedule_from)&&!(e.hasOwnProperty("schedule_to")&&n>e.schedule_to)},e.getScheduledText=function(e){var n="";return e.published||(n+="Ikke udgivet!<br/>"),e.hasOwnProperty("schedule_from")&&(n=n+"Udgivet fra: "+i("date")(1e3*e.schedule_from,"dd/MM/yyyy HH:mm")+".<br/>"),e.hasOwnProperty("schedule_to")&&(n=n+"Udgivet til: "+i("date")(1e3*e.schedule_to,"dd/MM/yyyy HH:mm")+"."),n},e.goToStep=function(n){var t=1;e.validation.titleSet()&&(t++,e.validation.orientationSet()&&(t+=3)),n<=t&&s(n)},e.pushRight=function(n){n===e.channel.slides.length-1?u(e.channel.slides,n,0):u(e.channel.slides,n,n+1)},e.pushLeft=function(n){0===n?u(e.channel.slides,n,e.channel.slides.length-1):u(e.channel.slides,n,n-1)},e.handleDrop=function(n,t){n=parseInt(n.split("index-")[1]),t=parseInt(t.split("index-")[1]);var r=e.channel.slides.splice(n,1);e.channel.slides.splice(t,0,r[0])},e.sortSlides=function(n){if("random"===n)return void(e.channel.slides=p(e.channel.slides));var t=e.lastSortUsed===n;e.lastSortUsed=n,e.channel.slides=i("orderBy")(e.channel.slides,t?"-":""+n)}}]),angular.module("ikApp").controller("ChannelOverviewController",["$scope","sharedChannelFactory","channelFactory","busService",function(e,n,t,r){"use strict";e.shareDialogShow=!1,e.shareDialogChannel=null,window.config.sharingService.enabled&&(e.$on("ikChannelShare.clickShare",function(n,i){e.shareDialogShow=!0,e.shareDialogChannel=i,t.getChannel(i.id).then(function(n){e.shareDialogChannel=n,e.shareDialogChannel.sharing_indexes||(e.shareDialogChannel.sharing_indexes=[])},function(e){r.$emit("log.error",{cause:e,msg:"Hentning af kanal fejlede"})})}),e.sharingIndexes=[],n.getSharingIndexes().then(function(n){e.sharingIndexes=n},function(e){r.$emit("log.error",{cause:e,msg:"Hentning af delingsindeks fejlede."})}),e.saveSharingChannel=function(){t.channelShare(e.shareDialogChannel).then(function(){r.$emit("log.info",{msg:"Delingskonfiguration af kanal lykkedes.",timeout:3e3})},function(e){r.$emit("log.error",{cause:e,msg:"Deling af kanal fejlede."})})})}]),angular.module("ikApp").controller("MediaEditController",["$scope","$location","$routeParams","$timeout","mediaFactory","busService",function(e,n,t,r,i,o){"use strict";i.getMedia(t.id).then(function(t){e.media=t,e.media==={}&&n.path("/media-overview")},function(e){o.$emit("log.error",{cause:e,msg:"Kunne ikke hente media med id: "+t.id}),n.path("/media-overview")}),e["delete"]=function(){i.deleteMedia(e.media.id).then(function(){o.$emit("log.info",{msg:"Media slettet.",timeout:3e3}),r(function(){n.path("/media-overview")},500)},function(e){o.$emit("log.error",{cause:e,msg:"Sletning af media fejlede."})})},e.getContentType=function(e){if(!e)return"";var n=e.content_type.split("/");return n[0]},e.videoPath=function(e,n){var t="";return e.provider_metadata.forEach(function(e){e.format===n&&(t=e.reference),"thumbnail_landscape"===n&&e.thumbnails.forEach(function(e){"mp4_landscape"===e.label&&(t=e.reference)})}),t}}]),angular.module("ikApp").controller("MediaOverviewController",["$scope","$location",function(e,n){"use strict";e.$on("mediaOverview.selectMedia",function(e,t){n.path("/media/"+t.id)})}]),angular.module("ikApp").controller("MediaUploadController",["$scope",function(e){"use strict";e.$on("mediaUpload.uploadComplete",function(e,n){})}]),angular.module("ikApp").controller("ScreenController",["$scope","$location","$routeParams","$timeout","screenFactory","channelFactory","sharedChannelFactory","templateFactory","busService",function(e,n,t,r,i,o,a,l,s){"use strict";function c(){t.id?null===t.id||void 0===t.id||""===t.id?n.path("/screen-overview"):i.getEditScreen(t.id).then(function(t){e.loading=!1,e.screen=t,e.screen.channel_screen_regions.forEach(function(e){e.shared_channel&&(e.shared_channel.content=JSON.parse(e.shared_channel.content),e.shared_channel.title=e.shared_channel.content.title,e.shared_channel.slides=e.shared_channel.content.slides)}),e.screen==={}&&n.path("/screen")},function(e){s.$emit("log.error",{cause:e,msg:"Skærmen med id: "+t.id+" blev ikke fundet"})}):(e.screen=i.emptyScreen(),l.getScreenTemplate("full-screen").then(function(n){e.screen.template=n,e.loading=!1},function(n){404===n&&l.getScreenTemplates().then(function(n){e.screen.template=angular.copy(n[0]),e.screen.orientation=n[0].orientation,e.loading=!1},function(e){s.$emit("log.error",{cause:e,msg:"Skabelonerne blev ikke loaded"})})}))}e.loading=!0,e.sharingEnabled=window.config.sharingService.enabled,e.screen={},e.toolbarTemplate=null,e.display=!1,e.region=null,c(),e.saveScreenAndClose=function(){e.displayToolbar=!1,e.region=null,i.saveScreen().then(function(e){s.$emit("log.info",{msg:"Skærmen ("+e.title+") er gemt",timeout:5e3}),r(function(){n.path("/screen-overview")},1e3)},function(e){s.$emit("log.error",{cause:e,msg:"Skærmen blev ikke gemt"})})},e.saveScreen=function(){e.displayToolbar=!1,e.region=null,i.saveScreen().then(function(e){s.$emit("log.info",{msg:"Skærmen ("+e.title+") er gemt",timeout:5e3})},function(e){s.$emit("log.error",{cause:e,msg:"Skærmen blev ikke gemt"})})},e.triggerTool=function(n){e.screen.template.tools.hasOwnProperty(n.name)?e.toolbarTemplate=e.screen.template.tools[n.name]:e.toolbarTemplate="app/shared/toolbars/"+n.name+".html?"+window.config.version,e.region=n.region,e.displayToolbar=!0}}]),angular.module("ikApp").controller("ScreenOverviewController",["$scope","screenFactory","userFactory","busService",function(e,n,t,r){"use strict";e.loading=!1,e.sort={created_at:"desc"},e.pager={size:6,page:0},e.hits=0,e.screens=[];var i={fields:["title"],text:"",sort:{created_at:{order:"desc"}},pager:e.pager};e.updateSearch=function(){i.text=e.search_text,e.loading=!0,n.searchScreens(i).then(function(t){e.hits=t.hits;for(var i=[],o=0;o<t.results.length;o++)i.push(t.results[o].id);n.loadScreensBulk(i).then(function(n){e.screens=n,e.loading=!1},function(n){r.$emit("log.error",{cause:n,msg:"Kunne ikke hente søgeresultater."}),e.loading=!1})})},e.$on("screen-deleted",function(){e.updateSearch()}),e.setUser=function(n){e.showFromUser!==n&&(e.showFromUser=n,e.setSearchFilters())},e.setSearchFilters=function(){if(delete i.filter,"all"!==e.showFromUser&&(i.filter={bool:{must:[]}}),"all"!==e.showFromUser){var n={};n.term={user:e.currentUser.id},i.filter.bool.must.push(n)}e.updateSearch()},e.setSort=function(n,t){void 0!==e.sort[n]&&e.sort[n]===t||(e.sort={},e.sort[n]=t,i.sort={},i.sort[n]={order:t},e.updateSearch())},t.getCurrentUser().then(function(n){e.currentUser=n,e.showFromUser=e.currentUser.search_filter_default,e.setSearchFilters()})}]),angular.module("ikApp").controller("SlideController",["$scope","$location","$routeParams","$timeout","slideFactory","templateFactory","channelFactory","busService",function(e,n,t,r,i,o,a,l){"use strict";function s(n){e.step=n,e.templatePath="/app/pages/slide/slide-step"+e.step+".html?"+window.config.version}function c(){a.getChannels().then(function(n){e.channels=n}),t.id?null===t.id||void 0===t.id||""===t.id?n.path("/slide"):(i.clearCurrentSlide(),i.getEditSlide(t.id).then(function(t){e.slide=t,e.slide.status="edit-slide",e.slide==={}&&n.path("/slide"),s(3)},function(e){l.$emit("log.error",{cause:e,msg:"Kunne ikke hente slide med id: "+t.id}),n.path("/slide-overview")})):(e.slide=i.emptySlide(),e.slide.channels=[],s(1))}function d(n){return!!e.slide&&""!==e.slide[n]}e.steps=5,e.slide={},e.templates=[],o.getSlideTemplates().then(function(n){for(var t in n)n.hasOwnProperty(t)&&e.templates.push(n[t])},function(e){l.$emit("log.error",{cause:e,msg:"Kunne ikke hente slide templates."})}),e.channels=[],e.editor={channelOverviewEditor:!1,toggleChannelOverviewEditor:function(){l.$emit("bodyService.toggleClass","is-locked"),e.editor.channelOverviewEditor=!e.editor.channelOverviewEditor}},e.$on("channelOverview.clickChannel",function(n,t){e.toggleChannel(t)}),c(),e.submitStep=function(){e.step===e.steps?(e.disableSubmitButton=!0,""===e.slide.duration&&(e.slide.duration=15),i.saveSlide().then(function(){l.$emit("log.info",{msg:"Slide er gemt",timeout:3e3}),r(function(){n.path("/slide-overview")},1e3)},function(n){l.$emit("log.error",{cause:n,msg:"Kunne ikke gemme slide"}),e.disableSubmitButton=!1})):s(e.step+1)},e.validation={titleSet:function(){return d("title")},templateSet:function(){return d("template")}},e.goToStep=function(n){var t=1;e.validation.titleSet()&&(t++,e.validation.templateSet()&&(t+=3)),n<=t&&s(n)},e.selectTemplate=function(n){e.slide.template=n;var t=null;e.templates.forEach(function(e){e.id===n&&(t=e)}),null!==t&&(e.slide.slide_type=t.slide_type,e.slide.options||(e.slide.options={}),e.slide.orientation=t.orientation,angular.forEach(t.empty_options,function(n,t){void 0===e.slide.options[t]&&(e.slide.options[t]=angular.copy(n))}),""===e.slide.options.headline&&(e.slide.options.headline=e.slide.title),e.slide.media_type=t.media_type)},e.channelSelected=function(n){var t=!1;return e.slide.channels.forEach(function(e){n.id===e.id&&(t=!0)}),t},e.hasChannel=function(n){var t=!1;return e.slide.channels.forEach(function(e){n.id===e.id&&(t=!0)}),t},e.toggleChannel=function(n){var t=null;e.slide.channels.forEach(function(e,r){n.id===e.id&&(t=r)}),null!==t?e.slide.channels.splice(t,1):e.slide.channels.push(n)}}]),angular.module("ikApp").controller("SlideEditController",["$scope","$http","$filter","mediaFactory","slideFactory","kobaFactory","busService","templateFactory",function(e,n,t,r,i,o,a,l){"use strict";function s(e,n,t){var r=e[n];e[n]=e[t],e[t]=r}e.step="background-picker",e.addevent={title:null,place:null,from:null,to:null},i.getEditSlide(null).then(function(n){e.slide=n,l.getSlideTemplate(n.template).then(function(n){e.template=n},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke loade værktøjer til slidet."})})},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke hente slide."})}),e.openTool=function(n){a.$emit("bodyService.toggleClass","is-locked"),e.editor.editorOpen?(e.editor.editorOpen=!1,e.editorURL=""):("manual-calendar-editor"===n.id?(e.addevent.title=null,e.addevent.place=null,e.addevent.from=null,e.addevent.to=null,e.sortEvents()):"event-calendar-editor"===n.id&&(e.availableResources=[],o.getResources().then(function(n){if(e.availableResources=n,e.slide.options.hasOwnProperty("resources"))for(var t=[],r=e.slide.options.resources.length,i=0;i<r;i++){for(var o=!1,a=0;a<n.length;a++)if(n[a].mail===e.slide.options.resources[i].mail){o=!0;break}o&&t.push(e.slide.options.resources[i])}e.slide.options.resources=t},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke hente bookings for ressource."})})),e.editor.editorOpen=!0,n.path?e.editorURL=n.path+"?"+window.config.version:e.editorURL="templates/editors/"+n.id+".html?"+window.config.version)},e.editor={editorOpen:!1,hideEditors:function(){a.$emit("bodyService.removeClass","is-locked"),e.editor.editorOpen=!1,e.editorURL=""}},e.clickBackgroundColor=function(){e.slide.options.images=[]},e.addEventItem=function(){var n={title:e.addevent.title,place:e.addevent.place,from:e.addevent.from,to:e.addevent.to};e.slide.options.eventitems.push(n),e.addevent.title=null,e.addevent.place=null,e.addevent.from=null,e.addevent.to=null,n=null},e.removeEventItem=function(n){e.slide.options.eventitems.splice(e.slide.options.eventitems.indexOf(n),1)},e.sortEvents=function(){e.slide.options.eventitems.length>0&&(e.slide.options.eventitems=t("orderBy")(e.slide.options.eventitems,"from"))},e.eventIsOutdated=function(e){var n=e.to,t=e.from,r=Date.now()/1e3;return n&&r>n||!n&&r>t},e.addCalendarEvents=function(){for(var n=[],t=function(e){for(var t=0;t<e.length;t++){var r=e[t];n.push(r)}},r=0;r<e.slide.options.resources.length;r++){var i=e.slide.options.resources[r],l=new Date,s=new Date(l.getFullYear(),l.getMonth(),l.getDate()).getTime()/1e3,c=s+86400;o.getBookingsForResource(i.mail,s,c).then(t,function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke hente bookings for ressource."})})}e.slide.external_data=n};var c=function(n){for(var t=[],r=!1,i=0;i<e.slide.media.length;i++){var o=e.slide.media[i];o.id!==n.id?"slideshow"===e.slide.slide_type&&t.push(o):r=!0}r||t.push(n),e.slide.media=t};e.$on("mediaOverview.selectMedia",function(n,t){"logo"===t.media_type?(e.slide.logo=t,e.logoStep="logo-picker"):c(t)}),e.$on("mediaUpload.uploadSuccess",function(n,t){r.getMedia(t.id).then(function(n){"logo"===n.media_type?(e.slide.logo=n,e.logoStep="logo-picker"):"slideshow"===e.slide.slide_type?e.slide.media.push(n):e.slide.media=[n]},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke tilføje media."})});var i=t.queue.find(function(e,n){return!e.isSuccess});i||e.editor.hideEditors()}),e.step="background-picker",e.pushMediaRight=function(n){n===e.slide.media.length-1?s(e.slide.media,n,0):s(e.slide.media,n,n+1)},e.pushMediaLeft=function(n){0===n?s(e.slide.media,n,e.slide.media.length-1):s(e.slide.media,n,n-1)},e.removeMedia=function(n){e.slide.media.splice(n,1)},e.backgroundPicker=function(){e.step="background-picker"},e.pickFromMedia=function(){e.step="pick-from-media",e.$emit("mediaOverview.updateSearch")},e.pickFromComputer=function(){e.step="pick-from-computer"},e.logoStep="logo-picker",e.logoPicker=function(){e.logoStep="logo-picker"},e.pickLogoFromMedia=function(){e.logoStep="pick-logo-from-media",e.$emit("mediaOverview.updateSearch")},e.pickLogoFromComputer=function(){e.logoStep="pick-logo-from-computer"},e.logoPositions=[{value:{top:"0",bottom:"auto",left:"0",right:"auto"},text:"top venstre"},{value:{top:"0",bottom:"auto",left:"auto",right:"0"},text:"top højre"},{value:{top:"auto",bottom:"0",left:"0",right:"auto"},text:"bund venstre"},{value:{top:"auto",bottom:"0",left:"auto",right:"0"},text:"bund højre"}],e.logoSizes=[{value:"5%",text:"Meget lille (5% af skærmen)"},{value:"10%",text:"Lille (10% af skærmen)"},{value:"15%",text:"Medium (15% af skærmen)"},{value:"20%",text:"Stor (20% af skærmen)"},{value:"40%",text:"Ekstra stor (40% af skærmen)"}],e.handleDropMedia=function(n,t){n=parseInt(n.split("index-")[1]),t=parseInt(t.split("index-")[1]);var r=e.slide.media.splice(n,1);e.slide.media.splice(t,0,r[0])}}]),angular.module("ikApp").controller("SharedChannelController",["$scope","$location","$routeParams","$timeout","screenFactory","sharedChannelFactory","busService",function(e,n,t,r,i,o,a){"use strict";function l(n){e.step=n,e.templatePath="/app/pages/sharedChannel/shared-channel-step"+e.step+".html?"+window.config.version}function s(){t.id&&t.index?o.getSharedChannel(t.id,t.index).then(function(t){e.channel=JSON.parse(t.content),e.channel==={}&&n.path("/channel-sharing-overview"),l(1)},function(e){a.$emit("log.error",{cause:e,msg:"Delt kanal kunne ikke hentes."})}):n.path("/channel-sharing-overview")}e.steps=1,e.step=1,e.channel={},e.channel.slides=[],e.status="edit",i.getScreens().then(function(n){e.screens=n},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke hente skærme."})}),s(),e.submitStep=function(){n.path("/channel-sharing-overview")},e.goToStep=function(e){l(e)}}]),angular.module("ikApp").controller("SharedChannelOverviewController",["$scope",function(e){"use strict"}]),angular.module("ikApp").controller("SlideOverviewController",["$scope","$location",function(e,n){"use strict";e.$on("slideOverview.clickSlide",function(e,t){n.path("/slide/"+t.id)})}]),angular.module("ikApp").filter("activeEvents",function(){"use strict";return function(e){if(!angular.isArray(e))return!1;for(var n=parseInt(Date.now()/1e3),t=[],r=0;r<e.length;r++){var i=e[r];i.from&&i.to&&i.to>=n?t.push(i):i.from&&i.from>=n&&t.push(i)}return t}}),angular.module("ikApp").factory("authHttpResponseInterceptor",["$q","$location","$window",function(e,n,t){"use strict";return{responseError:function(n){return 401===n.status&&(t.location.href="/logout"),e.reject(n)}}}]),angular.module("ikApp").config(["$httpProvider",function(e){"use strict";e.interceptors.push("authHttpResponseInterceptor")}]),angular.module("ikApp").factory("channelFactory",["$http","$q","busService",function(e,n,t){"use strict";var r={},i={};return r.searchChannels=function(e){var r=n.defer();e.type="Indholdskanalen\\MainBundle\\Entity\\Channel";var i=CryptoJS.MD5(JSON.stringify(e)).toString();return e.callbacks={hits:"searchService.hits-"+i,error:"searchService.error-"+i},t.$once(e.callbacks.hits,function(e,n){r.resolve(n)}),t.$once(e.callbacks.error,function(e,n){t.$emit("log.error",{cause:n,msg:"Kunne ikke hente søgeresultater."}),r.reject(n)}),t.$emit("searchService.request",e),r.promise},r.getChannels=function(){var t=n.defer();return e.get("/api/channel").success(function(e){t.resolve(e)}).error(function(){t.reject()}),t.promise},r.loadChannelsBulk=function(t){var r=n.defer(),i="?ids[]="+t.join("&ids[]=");return e.get("/api/bulk/channel/api-bulk"+i).success(function(e,n){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r.getEditChannel=function(t){var r=n.defer();return null===t||void 0===t||""===t?r.resolve(i):e.get("/api/channel/"+t).success(function(e){i=e,r.resolve(i)}).error(function(){r.reject()}),r.promise},r.getChannel=function(t){var r=n.defer();return e.get("/api/channel/"+t).success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},r.emptyChannel=function(){return i={id:null,title:"",orientation:"",created_at:parseInt((new Date).getTime()/1e3),slides:[],screens:[],sharing_indexes:[],schedule_repeat_days:[]}},r.saveChannel=function(){var t=n.defer();return e.post("/api/channel",i).success(function(){t.resolve("success"),i=null}).error(function(){t.reject("error")}),t.promise},r.channelShare=function(t){var r=n.defer();return e.post("/api/channel/share",t).success(function(e){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r}]),angular.module("ikApp").factory("kobaFactory",["$http","$q",function(e,n){"use strict";var t={};return t.getResources=function(){var t=n.defer();return e.get("/api/koba/resources").success(function(e){t.resolve(e)}).error(function(e,n){t.reject(n)}),t.promise},t.getBookingsForResource=function(t,r,i){var o=n.defer();return e.get("/api/koba/resources/"+t+"/bookings/from/"+r+"/to/"+i).success(function(e){o.resolve(e)}).error(function(e,n){o.reject(n)}),o.promise},t}]),angular.module("ikApp").factory("mediaFactory",["$http","$q","busService",function(e,n,t){"use strict";var r={};return r.getAllMedia=function(){var t=n.defer();return e.get("/api/media").success(function(e){t.resolve(e)}).error(function(){t.reject()}),t.promise},r.searchMedia=function(e){var r=n.defer();e.type="Application\\Sonata\\MediaBundle\\Entity\\Media";var i=CryptoJS.MD5(JSON.stringify(e)).toString();return e.callbacks={hits:"searchService.hits-"+i,error:"searchService.error-"+i},t.$once(e.callbacks.hits,function(e,n){r.resolve(n)}),t.$once(e.callbacks.error,function(e,n){t.$emit("log.error",{cause:n,msg:"Kunne ikke hente søgeresultater."}),r.reject(n)}),t.$emit("searchService.request",e),r.promise},r.loadMediaBulk=function(t){var r=n.defer(),i="?ids[]="+t.join("&ids[]=");return e.get("/api/bulk/media/api"+i).success(function(e,n){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r.getMedia=function(t){var r=n.defer();return e.get("/api/media/"+t).success(function(e){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r.deleteMedia=function(t){var r=n.defer();return e["delete"]("/api/media/"+t).success(function(e){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r}]),angular.module("ikApp").factory("screenFactory",["$http","$q","busService",function(e,n,t){"use strict";var r={},i=null;return r.searchScreens=function(e){var r=n.defer();e.type="Indholdskanalen\\MainBundle\\Entity\\Screen";var i=CryptoJS.MD5(JSON.stringify(e)).toString();return e.callbacks={hits:"searchService.hits-"+i,error:"searchService.error-"+i},t.$once(e.callbacks.hits,function(e,n){r.resolve(n)}),t.$once(e.callbacks.error,function(e,n){t.$emit("log.error",{cause:n,msg:"Kunne ikke hente søgeresultater."}),r.reject(n)}),t.$emit("searchService.request",e),r.promise},r.getScreens=function(){var t=n.defer();return e.get("/api/screen").success(function(e){t.resolve(e)}).error(function(e,n){t.reject(n)}),t.promise},r.loadScreensBulk=function(t){var r=n.defer(),i="?ids[]="+t.join("&ids[]=");return e.get("/api/bulk/screen/api"+i).success(function(e,n){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r.getEditScreen=function(t){var r=n.defer();return null===t||void 0===t||""===t?r.resolve(i):e.get("/api/screen/"+t).success(function(e){i=e,r.resolve(i)}).error(function(e,n){r.reject(n)}),r.promise},r.getScreen=function(t){var r=n.defer();return e.get("/api/screen/"+t).success(function(e){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r.saveScreen=function(){var t=n.defer();return null===i?t.reject(404):e.post("/api/screen",i).success(function(e){i.id=e,t.resolve(i)}).error(function(e,n){t.reject(n)}),t.promise},r.emptyScreen=function(){return i={id:null,template:null,description:"",title:"",orientation:"landscape",width:1920,height:1080,channel_screen_regions:[],options:{}}},r}]),angular.module("ikApp").factory("sharedChannelFactory",["$http","$q","sharedSearchFactory",function(e,n,t){"use strict";var r={},i=null;return r.searchChannels=function(e,n){return e.type="Indholdskanalen\\MainBundle\\Entity\\Channel",t.search(e,n)},r.getSharedChannel=function(t,r){var i=n.defer();return e.get("/api/sharing/channel/"+t+"/"+r).success(function(e){i.resolve(e)}).error(function(e,n){i.reject(n)}),i.promise},r.saveSharedChannel=function(t){var r=n.defer();return e.post("/api/sharing/channel",t).success(function(e){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r.getAvailableIndexes=function(){var t=n.defer();return null!==i?t.resolve(i):e.get("/api/sharing/available_indexes").success(function(e){i=e,t.resolve(e)}).error(function(e,n){t.reject(n)}),t.promise},r.saveSharingIndexes=function(t){var r=n.defer();return e.post("/api/sharing/indexes",t).success(function(e){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r.getSharingIndexes=function(){var t=n.defer();return e.get("/api/sharing/indexes").success(function(e){t.resolve(e)}).error(function(e,n){t.reject(n)}),t.promise},r}]),angular.module("ikApp").service("sharedSearchFactory",["$q","$rootScope","$http","busService",function(e,n,t,r){"use strict";function i(e){a=io.connect(window.config.sharingService.address,{query:"token="+l,"force new connection":!0,"max reconnection attempts":1/0}),a.on("error",function(n){"Not authorized"===n?t.get("api/auth/sharing/reauth").success(function(n){l=n.token,i(e)}).error(function(n,t){r.$emit("log.error",{cause:t,msg:"Search socket error. Could not reauthorize."}),e.reject(t)}):(r.$emit("log.error",{cause:n,msg:"Search socket error."}),e.reject(n))}),a.on("connect",function(){e.resolve("Connected to the server.")}),a.on("disconnect",function(e){})}function o(){var n=e.defer();return void 0===a?null!==l?i(n):t.get("api/auth/sharing").success(function(e){l=e.token,i(n)}).error(function(e,t){r.$emit("log.error",{cause:t,msg:"Authentication (sharing) to search node failed ("+t+")"}),n.reject(t)}):n.resolve("Connected to the server."),n.promise}var a,l=null;this.search=function(n,t){var i=e.defer(),l={index:t,type:n.type,query:{match_all:{}}};return void 0!==n.text&&""!==n.text&&(l.query={multi_match:{query:n.text,type:"best_fields",operator:"or",fields:n.fields,analyzer:"string_search"}}),l.sort=n.sort,void 0!==n.filter&&(l.query={filtered:{query:l.query,filter:n.filter}}),n.hasOwnProperty("pager")&&(l.size=n.pager.size,l.from=n.pager.page*n.pager.size),l.uuid=CryptoJS.MD5(JSON.stringify(l)).toString(),l.callbacks={hits:"hits-"+l.uuid,error:"error-"+l.uuid},o().then(function(){a.emit("search",l),a.once(l.callbacks.hits,function(e){i.resolve(e)}),a.once(l.callbacks.error,function(e){r.$emit("log.error",{cause:e.message,msg:"Search error"}),i.reject(e.message)})}),i.promise}}]),angular.module("ikApp").factory("slideFactory",["$http","$q","busService",function(e,n,t){"use strict";var r={},i=null;return r.searchSlides=function(e){var r=n.defer();e.type="Indholdskanalen\\MainBundle\\Entity\\Slide";var i=CryptoJS.MD5(JSON.stringify(e)).toString();return e.callbacks={hits:"searchService.hits-"+i,error:"searchService.error-"+i},t.$once(e.callbacks.hits,function(e,n){r.resolve(n)}),t.$once(e.callbacks.error,function(e,n){t.$emit("log.error",{cause:n,msg:"Kunne ikke hente søgeresultater."}),r.reject(n)}),t.$emit("searchService.request",e),r.promise},r.getSlides=function(){var t=n.defer();return e.get("/api/slide").success(function(e,n){t.resolve(e)}).error(function(e,n){t.reject(n)}),t.promise},r.loadSlidesBulk=function(t){var r=n.defer(),i="?ids[]="+t.join("&ids[]=");return e.get("/api/bulk/slide/api-bulk"+i).success(function(e,n){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r.clearCurrentSlide=function(){i=null},r.getEditSlide=function(t){var r=n.defer();return null===t||void 0===t||""===t?r.resolve(i):null!==i&&i.id==t?r.resolve(i):e.get("/api/slide/"+t).success(function(e,n){i=e,r.resolve(i)}).error(function(e,n){r.reject(n)}),r.promise},
r.getSlide=function(t){var r=n.defer();return e.get("/api/slide/"+t).success(function(e,n){r.resolve(e)}).error(function(e,n){r.reject(n)}),r.promise},r.saveSlide=function(){var t=n.defer();return e.post("/api/slide",i).success(function(e){t.resolve(e),i=null}).error(function(e,n){t.reject(n)}),t.promise},r.emptySlide=function(){return i={id:null,published:!0,schedule_from:null,schedule_to:null,media:[],media_type:null,title:"",user:"",duration:"",orientation:"",template:"",options:null}},r}]),angular.module("ikApp").factory("templateFactory",["$q","$http",function(e,n){"use strict";var t={},r=null,i=null;return t.getSlideTemplates=function(){var t=e.defer();return null!==r?t.resolve(r):n.get("/api/templates/slides/enabled").success(function(e){r=e,t.resolve(r)}).error(function(e,n){t.reject(n)}),t.promise},t.getSlideTemplate=function(n){var r=e.defer();return t.getSlideTemplates().then(function(e){for(var t=0;t<e.length;t++)if(e[t].id===n)return void r.resolve(e[t]);r.reject(404)},function(e){r.reject(e)}),r.promise},t.getScreenTemplates=function(){var t=e.defer();return null!==i?t.resolve(i):n.get("/api/templates/screens/enabled").success(function(e){i=e,t.resolve(i)}).error(function(e,n){t.reject(n)}),t.promise},t.getScreenTemplate=function(n){var r=e.defer();return t.getScreenTemplates().then(function(e){for(var t=0;t<e.length;t++)if(e[t].id===n)return void r.resolve(e[t]);r.reject(404)},function(e){r.reject(e)}),r.promise},t.saveEnabledTemplates=function(t,o){var a=e.defer();return n.post("/api/templates/save/enabled",{screens:t,slides:o}).success(function(e,t){n.get("/api/templates/slides/enabled").success(function(e){r=e}).error(function(e,n){}),n.get("/api/templates/screens/enabled").success(function(e){i=e}).error(function(e,n){}),a.resolve(t)}).error(function(e,n){a.reject(n)}),a.promise},t.getAllSlideTemplates=function(){var t=e.defer();return n.get("/api/templates/slides/all").success(function(e){r=e,t.resolve(r)}).error(function(e,n){t.reject(n)}),t.promise},t.getAllScreenTemplates=function(){var t=e.defer();return n.get("/api/templates/screens/all").success(function(e){r=e,t.resolve(r)}).error(function(e,n){t.reject(n)}),t.promise},t}]),angular.module("ikApp").factory("userFactory",["$http","$q",function(e,n){"use strict";var t,r={};return r.getCurrentUser=function(){var r=n.defer();return void 0===t?e.get("/api/user").success(function(e){t=e,r.resolve(e)}).error(function(){r.reject()}):r.resolve(t),r.promise},r}]),function(){"use strict";var e;e=angular.module("itkDateComponent",[]),e.directive("dateComponent",["$interval",function(e){return{restrict:"E",replace:!0,templateUrl:"app/shared/components/date/date.html?"+window.config.version,scope:{theme:"@"},link:function(n){n.thisDate=new Date;var t=e(function(){n.thisDate=new Date},6e4);n.$on("$destroy",function(){angular.isDefined(t)&&(e.cancel(t),t=void 0)})}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkDigitalClockComponent",[]),e.directive("digitalClockComponent",["$interval",function(e){return{restrict:"E",replace:!0,templateUrl:"app/shared/components/digital-clock/digital-clock.html?"+window.config.version,scope:{},link:function(n){n.thisDate=new Date;var t=e(function(){n.thisDate=Date.now()},1e3);n.$on("$destroy",function(){angular.isDefined(t)&&(e.cancel(t),t=void 0)})}}}])}.call(this),angular.module("ikApp").directive("ikActionReloadScreen",["$http","busService",function(e,n){"use strict";return{restrict:"E",replace:!1,scope:{id:"@"},link:function(t){t.reloadScreen=function(){var r=window.confirm("Er du sikker på at du vil genindlæse skærmen?");r===!0&&e.post("/api/screen/"+t.id+"/reload").success(function(){n.$emit("log.info",{msg:"Genindlæsning lykkedes.",timeout:3e3})}).error(function(e){n.$emit("log.error",{cause:e,msg:"Genindlæsning lykkedes ikke! Dette kan skyldes at skærmen ikke er forbundet."})})}},templateUrl:"app/shared/elements/actionReloadScreen/action-reload-screen.html?"+window.config.version}}]),angular.module("ikApp").directive("ikChannelOverview",["channelFactory","userFactory","busService","$filter",function(e,n,t,r){"use strict";return{restrict:"E",scope:{ikSelectedChannels:"=",ikOverlay:"@"},link:function(i){i.displaySharingOption=window.config.sharingService.enabled,i.loading=!1,i.sort={created_at:"desc"},i.pager={size:6,page:0},i.hits=0,i.channels=[];var o={fields:"title",text:"",filter:{bool:{must:[]}},sort:{created_at:{order:"desc"}},pager:i.pager};i.updateSearch=function(){o.text=i.search_text,i.loading=!0,e.searchChannels(o).then(function(n){i.hits=n.hits;for(var r=[],o=0;o<n.results.length;o++)r.push(n.results[o].id);e.loadChannelsBulk(r).then(function(e){i.channels=e,i.loading=!1},function(e){t.$emit("log.error",{cause:e,msg:"Kunne ikke loade søgeresultatet."}),i.loading=!1})})},i.$on("channel-deleted",function(){i.updateSearch()}),i.channelSelected=function(e){if(!i.ikSelectedChannels)return!1;var n=!1;return i.ikSelectedChannels.forEach(function(t){t.id===e.id&&(n=!0)}),n},i.channelOverviewClickChannel=function(e){i.$emit("channelOverview.clickChannel",e)},i.setUser=function(e){i.showFromUser!==e&&(i.showFromUser=e,i.setSearchFilters())},i.setSearchFilters=function(){delete o.filter,"all"!==i.showFromUser&&(o.filter={bool:{must:[]}});var e={};"all"!==i.showFromUser&&(e.term={user:i.currentUser.id},o.filter.bool.must.push(e)),i.updateSearch()},i.setSort=function(e,n){void 0!==i.sort[e]&&i.sort[e]===n||(i.sort={},i.sort[e]=n,o.sort={},o.sort[e]={order:n},i.updateSearch())},i.channelScheduledNow=function(e){var n=new Date,t=n.getDay(),r=n.getHours();if(n=parseInt(n.getTime()/1e3),e.hasOwnProperty("publish_from")&&n<e.publish_from)return!1;if(e.hasOwnProperty("publish_to")&&n>e.publish_to)return!1;if(e.hasOwnProperty("schedule_repeat")&&e.schedule_repeat){if(!(e.hasOwnProperty("schedule_repeat_days")&&e.schedule_repeat_days.length>0))return!1;for(var i=0;i<e.schedule_repeat_days.length;i++)if(t===e.schedule_repeat_days[i].id){if(e.hasOwnProperty("schedule_repeat_from")&&r<e.schedule_repeat_from)return!1;if(e.hasOwnProperty("schedule_repeat_to")&&r>e.schedule_repeat_to)return!1}}return!0},i.getScheduledText=function(e){var n="";if(e.hasOwnProperty("publish_from")&&(n=n+"Udgivet fra: "+r("date")(1e3*e.publish_from,"dd/MM/yyyy HH:mm")+".<br/>"),e.hasOwnProperty("publish_to")&&(n=n+"Udgivet til: "+r("date")(1e3*e.publish_to,"dd/MM/yyyy HH:mm")+".<br/>"),e.hasOwnProperty("schedule_repeat")&&e.schedule_repeat){n+="Vises disse dage:<br/>";for(var t=0;t<e.schedule_repeat_days.length;t++)n=n+e.schedule_repeat_days[t].name+" ";n+="<br/>",e.hasOwnProperty("schedule_repeat_from")&&(n=n+"Fra: "+e.schedule_repeat_from+":00<br/>"),e.hasOwnProperty("schedule_repeat_to")&&(n=n+"Til: "+e.schedule_repeat_to+":00<br/>")}return n},n.getCurrentUser().then(function(e){i.currentUser=e,i.showFromUser=i.currentUser.search_filter_default,i.setSearchFilters()})},templateUrl:"/app/shared/elements/channelOverview/channel-overview-directive.html?"+window.config.version}}]),angular.module("ikApp").directive("ikActionsMenu",[function(){"use strict";return{restrict:"E",replace:!1,transclude:!0,scope:{},link:function(e){e.menuOpen=!1,e.toggleMenu=function(){e.menuOpen=!e.menuOpen}},templateUrl:"app/shared/elements/actionsMenu/actions-menu.html?"+window.config.version}}]),angular.module("ikApp").directive("ikChecklist",[function(){"use strict";return{restrict:"E",replace:!1,scope:{elements:"=",selected:"=",identity:"="},link:function(e){e.toggleElement=function(n){if(e.selected){var t=-1;e.selected.forEach(function(r,i){r[e.identity]===n[e.identity]&&(t=i)}),t>-1?e.selected.splice(t,1):e.selected.push(n)}},e.elementSelected=function(n){if(!e.selected)return!1;for(var t=0;t<e.selected.length;t++)if(e.selected[t][e.identity]===n[e.identity])return!0;return!1}},templateUrl:"app/shared/elements/checklist/checklist.html?"+window.config.version}}]),function(){"use strict";var e;e=angular.module("itkControlPanel",[]),e.directive("controlPanel",["busService",function(e){return{restrict:"E",scope:{template:"=",data:"=",display:"=",saveAction:"&",region:"=",options:"="},replace:!0,link:function(n){n.selectedTab=null,e.$emit("bodyService.addClass","is-screen"),n.getContent=function(){return n.template},n.clickTab=function(e){n.selectedTab=e},n.toggleChannelType=function(e){n.channelType=e},n.$on("$destroy",function(){document.getElementsByTagName("body")[0].style.overflow=""})},template:'<div data-ng-include="getContent()"></div>'}}])}.call(this),angular.module("ikApp").directive("ikDelete",["$http","$rootScope","busService",function(e,n,t){"use strict";return{restrict:"E",replace:!1,scope:{id:"@",type:"@"},link:function(r){r.remove=function(){var i=window.confirm("Er du sikker på du vil slette dette? Handlingen kan ikke fortrydes.");i===!0&&e["delete"]("/api/"+r.type+"/"+r.id).success(function(){t.$emit("log.info",{msg:"Sletning lykkes.",timeout:3e3}),n.$broadcast(r.type+"-deleted",{})}).error(function(e){t.$emit("log.error",{cause:e,msg:"Sletning lykkes ikke!"})})}},templateUrl:"app/shared/elements/delete/delete.html?"+window.config.version}}]),angular.module("ikApp").directive("includeReplace",function(){"use strict";return{require:"ngInclude",restrict:"A",link:function(e,n){n.replaceWith(n.children())}}}),angular.module("ikApp").directive("ikMediaOverview",["busService",function(e){"use strict";return{restrict:"E",scope:{ikMediaType:"@",ikAutoSearch:"@",ikHideFilters:"=",ikSelectedMedia:"="},controller:["$scope","mediaFactory","userFactory",function(n,t,r){n.sort={created_at:"desc"},n.loading=!1,n.search_text="",n.media_type="all",n.media=[],n.pager={size:6,page:0},n.hits=0;var i={fields:"name",text:"",sort:{created_at:{order:"desc"}},pager:n.pager};n.updateSearch=function(){i.text=n.search_text,n.loading=!0,t.searchMedia(i).then(function(r){n.hits=r.hits;for(var i=[],o=0;o<r.results.length;o++)i.push(r.results[o].id);t.loadMediaBulk(i).then(function(e){n.media=e,n.loading=!1},function(t){e.$emit("log.error",{cause:t,msg:"Hentning af søgeresultater fejlede."}),n.loading=!1})})},n.mediaSelected=function(e){if(!n.ikSelectedMedia)return!1;var t=!1;return n.ikSelectedMedia.forEach(function(n){n.id===e.id&&(t=!0)}),t},n.filterMediaType=function(e){n.media_type!==e&&(n.media_type=e,n.setSearchFilters())},n.setSearchFilters=function(){if(delete i.filter,"all"===n.media_type&&"all"===n.showFromUser||(i.filter={bool:{must:[]}}),"all"!==n.media_type){var e={};e.term={media_type:n.media_type},i.filter.bool.must.push(e)}if("all"!==n.showFromUser&&n.currentUser){var e={};e.term={user:n.currentUser.id},i.filter.bool.must.push(e)}n.updateSearch()},n.setUser=function(e){n.showFromUser!==e&&(n.showFromUser=e,n.setSearchFilters())},n.setSort=function(e,t){void 0!==n.sort[e]&&n.sort[e]===t||(n.sort={},n.sort[e]=t,i.sort={},i.sort[e]={order:t},n.updateSearch())},n.mediaOverviewClickMedia=function(e){n.$emit("mediaOverview.selectMedia",e)},n.$on("mediaOverview.updateSearch",function(e){n.updateSearch(),e.preventDefault()}),r.getCurrentUser().then(function(e){n.currentUser=e,n.showFromUser=n.currentUser.search_filter_default,n.setSearchFilters()})}],link:function(e,n,t){t.$observe("ikMediaType",function(n){n&&n!=e.media_type&&e.filterMediaType(n)})},templateUrl:"/app/shared/elements/mediaOverview/media-overview-directive.html?"+window.config.version}}]),angular.module("ikApp").directive("ikMediaUpload",[function(){"use strict";return{restrict:"E",scope:{ikUploadType:"@",queueLimit:"="},controller:["$scope","FileUploader",function(e,n){e.currentStep=1,e.uploadComplete=!1,e.uploadErrors=!1,e.uploadInProgress=!1,e.uploadErrorText="";var t="|mp4|x-msvideo|x-ms-wmv|quicktime|mpeg|mpg|x-matroska|ogg|webm",r="|jpg|png|jpeg|bmp|gif",i="";i="image"===e.ikUploadType||"logo"===e.ikUploadType?r:"video"===e.ikUploadType?t:t+r,e.uploader=new n({url:"/api/media",queueLimit:e.queueLimit?e.queueLimit:1,filters:[{name:"mediaFilter",fn:function(e){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1);return i.indexOf(n)!==-1}}]}),e.selectFiles=function(){angular.element(document.querySelector("#select-files")).click()},e.clearQueue=function(){e.uploader.clearQueue(),e.uploadComplete=!1,e.uploadErrors=!1,e.currentStep=1,e.uploadErrorText=""},e.removeItem=function(n){n.remove(),e.uploader.queue.length<=0&&(e.currentStep=1,e.uploadComplete=!1,e.uploadErrors=!1)},e.upload=function(){e.uploadInProgress=!0,e.uploader.uploadAll()},e.isImage=function(e){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1);return r.indexOf(n)!==-1},e.getProgress=function(){if(e.uploader.progress)return e.uploadInProgress&&e.uploader.progress>5?e.uploader.progress-5:e.uploader.progress},e.uploader.onAfterAddingFile=function(n){n.formData=[{title:"",logo:!1}],"logo"===e.ikUploadType&&(n.formData[0].logo=!0)},e.uploader.onAfterAddingAll=function(){e.currentStep++},e.uploader.onErrorItem=function(n,t,r){e.uploadErrors=!0,e.uploadInProgress=!1,413===r?e.uploadErrorText="Filen var for stor (fejlkode: 413)":e.uploadErrorText="Der skete en fejl (fejlkode: "+r+")"},e.uploader.onCompleteAll=function(){e.uploadComplete=!0,e.uploadInProgress=!1},e.uploader.onSuccessItem=function(n,t){e.$emit("mediaUpload.uploadSuccess",{image:n,id:t[0],queue:e.uploader.queue})}}],link:function(){},templateUrl:"/app/shared/elements/mediaUpload/media-upload-directive.html?"+window.config.version}}]),function(){"use strict";var e;e=angular.module("ngModal",[]),e.directive("modalDialog",[function(){return{restrict:"E",scope:{show:"=",onClose:"&?"},replace:!0,transclude:!0,link:function(e){e.hideModal=function(){e.show=!1},e.$watch("show",function(n,t){if(n&&!t?document.getElementsByTagName("body")[0].style.overflow="hidden":document.getElementsByTagName("body")[0].style.overflow="",!n&&t&&null!==e.onClose)return e.onClose()})},templateUrl:"app/shared/elements/ngModal/ng-modal.html?"+window.config.version}}])}.call(this),angular.module("ikApp").directive("ikPager",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:["$scope",function(e){e.pagesFrom=0,e.pagesPerLine=10,e.changePage=function(n){e.pager.page=n,e.updateSearch(),e.pagesFrom=Math.floor(e.pager.page/e.pagesPerLine)*e.pagesPerLine},e.prevPage=function(){e.pager.page>0&&(e.pager.page--,e.updateSearch()),e.pager.page<e.pagesFrom&&(e.pagesFrom=e.pagesFrom-e.pagesPerLine)},e.nextPage=function(){e.pager.page<e.pager.max-1&&(e.pager.page++,e.updateSearch()),e.pager.page===e.pagesFrom+e.pagesPerLine&&(e.pagesFrom=e.pagesFrom+e.pagesPerLine)},e.prevLine=function(){e.pager.page>0&&(e.pager.page=e.pager.page-e.pagesPerLine,e.pager.page<0&&(e.pager.page=0),e.updateSearch()),e.pagesFrom=Math.floor(e.pager.page/e.pagesPerLine)*e.pagesPerLine},e.nextLine=function(){e.pager.page<e.pager.max-1&&(e.pager.page=e.pager.page+e.pagesPerLine,e.pager.page>=e.pager.max&&(e.pager.page=e.pager.max-1),e.updateSearch()),e.pagesFrom=Math.floor(e.pager.page/e.pagesPerLine)*e.pagesPerLine},e.$watch("hits",function(n){var t=[];if(e.pager.max=0,n>e.pager.size){e.pager.max=Math.ceil(n/e.pager.size);for(var r=0;r<e.pager.max;r++)t.push(r)}e.pager.pages=t})}],templateUrl:"/app/shared/elements/pager/pager-directive.html?"+window.config.version}}]),angular.module("ikApp").directive("autoGrow",function(){"use strict";return{restrict:"A",scope:{fontSize:"@"},link:function(e,n){var t=$(n),r=function(e){e.css("height","0px");var n=e.prop("scrollHeight"),t=e.css("min-height").replace("px","");e.css("height",Math.max(n,t)+"px")};n.bind("keyup",function(){r(t)}),e.$watch("fontSize",function(e){e&&r(t)}),setTimeout(function(){r(t)},100)}}}),angular.module("ikApp").directive("sharedChannelOverview",["sharedChannelFactory","userFactory","$timeout","busService",function(e,n,t,r){"use strict";return{restrict:"E",scope:{ikSelectedChannels:"=",ikOverlay:"@",ikSingleSlide:"="},link:function(t){t.index={},t.loading=!1,t.pickIndexDialog=!1,t.displaySharingOption=window.config.sharingService.enabled,t.sharingIndexes=[],e.getSharingIndexes().then(function(e){t.sharingIndexes=e}),t.sort={created_at:"desc"},n.getCurrentUser().then(function(e){t.currentUser=e,t.showFromUser=t.currentUser.search_filter_default},function(e){r.$emit("log.error",{cause:e,msg:"Kunne ikke loade bruger"})}),t.pager={size:6,page:0},t.hits=0,t.channels=[];var i={fields:"title",text:"",filter:{bool:{must:{}}},sort:{created_at:{order:"desc"}},pager:t.pager};t.updateSearch=function(){return i.text=t.search_text,angular.isUndefined(t.index.index)?void r.$emit("log.info",{msg:"Du skal vælge et indeks først.",timeout:3e3}):(t.loading=!0,void e.searchChannels(i,t.index.index).then(function(e){t.loading=!1,t.hits=e.hits,t.channels=e.results},function(e){r.$emit("log.error",{cause:e,msg:"Hentning af søgeresultater fejlede."}),t.loading=!1}))},t.$on("channel-deleted",function(){t.updateSearch()}),t.channelSelected=function(e){if(!t.ikSelectedChannels)return!1;var n=!1;return t.ikSelectedChannels.forEach(function(t){t.unique_id==e.unique_id&&(n=!0)}),n},t.clickSharedChannel=function(e,n){t.$emit("channelSharingOverview.clickSharedChannel",e,n)},t.setIndex=function(e){t.index=e,t.pickIndexDialog=!1,t.updateSearch()},t.setUser=function(e){t.showFromUser!==e&&(t.showFromUser=e,t.updateSearch())},t.setSearchFilters=function(){if(delete i.filter,"all"!==t.showFromUser&&(i.filter={bool:{must:[]}}),"all"!==t.showFromUser){var e={};e.term={user:t.currentUser.id},i.filter.bool.must.push(e)}t.updateSearch()},t.setSort=function(e,n){void 0!==t.sort[e]&&t.sort[e]===n||(t.sort={},t.sort[e]=n,i.sort={},i.sort[e]={order:n},t.updateSearch())}},templateUrl:"/app/shared/elements/sharedChannelOverview/shared-channel-overview.html?"+window.config.version}}]),angular.module("ikApp").directive("ikSharedChannel",["$interval","$location",function(e,n){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikChannel:"=",ikSingleSlide:"@",ikSharingIndex:"=",ikClickable:"="},link:function(t){t.slideIndex=0,t.playText="",t.$watch("ikChannel",function(e){e&&(t.ikChannel.slides.length<=0?t.templateURL="app/shared/elements/sharedChannel/empty-channel.html?"+window.config.version:(t.templateURL="app/shared/elements/sharedChannel/non-empty-channel.html?"+window.config.version,t.buttonState="play"),t.ikChannel.slides.forEach(function(e){$("head > link[href='"+e.css_path+"']")||$("head").append('<link rel="stylesheet" href="'+e.css_path+'" type="text/css" />')}))}),t.play=function(){angular.isDefined(t.interval)?(e.cancel(t.interval),t.interval=void 0,t.buttonState="play"):(t.slideIndex=(t.slideIndex+1)%t.ikChannel.slides.length,t.interval=e(function(){t.slideIndex=(t.slideIndex+1)%t.ikChannel.slides.length},2e3),t.buttonState="pause")},t.redirectToChannel=function(){t.ikClickable&&n.path("/shared-channel/"+t.ikChannel.unique_id+"/"+t.ikSharingIndex)},t.$on("$destroy",function(){angular.isDefined(t.interval)&&(e.cancel(t.interval),t.interval=void 0)})},templateUrl:"app/shared/elements/sharedChannel/shared-channel-template.html?"+window.config.version}}]),angular.module("ikApp").directive("ikChannel",["$interval","$location",function(e,n){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikChannel:"=",ikSingleSlide:"=",ikClickable:"="},link:function(t,r,i){t.slideIndex=0,t.playText="",i.$observe("ikChannel",function(e){e&&(t.ikChannel.slides.length<=0?t.templateURL="app/shared/elements/channel/empty.html?"+window.config.version:(t.templateURL="app/shared/elements/channel/non-empty.html?"+window.config.version,t.buttonState="play"))}),t.play=function(){angular.isDefined(t.interval)?(e.cancel(t.interval),t.interval=void 0,t.buttonState="play"):(t.slideIndex=(t.slideIndex+1)%t.ikChannel.slides.length,t.interval=e(function(){t.slideIndex=(t.slideIndex+1)%t.ikChannel.slides.length},2e3),t.buttonState="pause")},t.redirectToChannel=function(){t.ikClickable&&n.path("/channel/"+t.ikChannel.id)},t.$on("$destroy",function(){angular.isDefined(t.interval)&&(e.cancel(t.interval),t.interval=void 0)})},templateUrl:"app/shared/elements/channel/channel-template.html?"+window.config.version}}]),angular.module("ikApp").directive("ikSharedSlide",[function(){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikSlide:"="},link:function(e,n,t){e.templateURL="/app/shared/elements/slide/slide-loading.html?"+window.config.version,t.$observe("ikSlide",function(n){n&&(e.ikSlide.media_thumbs&&e.ikSlide.media_thumbs.length>0&&(e.ikSlide.currentImage=e.ikSlide.media_thumbs[0]),e.ikSlide.currentLogo=e.ikSlide.logo,e.templateURL=e.ikSlide.preview_path,e.theStyle={width:""+e.ikWidth+"px",height:""+parseFloat(1080*parseFloat(e.ikWidth/1920))+"px"},e.ikSlide.options.fontsize&&(e.theStyle.fontsize=""+parseFloat(e.ikSlide.options.fontsize*parseFloat(e.ikWidth/1920))+"px"))})},template:'<div class="preview--slide" data-ng-include="" src="templateURL"></div>'}}]),angular.module("ikApp").directive("ikSlide",["slideFactory","templateFactory","busService",function(e,n,t){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikSlide:"="},link:function(e,r,i){e.templateURL="/app/shared/elements/slide/slide-loading.html?"+window.config.version,i.$observe("ikSlide",function(r){r&&("image"===e.ikSlide.media_type?e.ikSlide.media.length>0?e.ikSlide.currentImage=e.ikSlide.media[0].urls.default_landscape_small:e.ikSlide.currentImage="":e.ikSlide.media.length>0&&e.ikSlide.media[0].provider_metadata.length>0&&e.ikSlide.media[0].provider_metadata[0].thumbnails&&e.ikSlide.media[0].provider_metadata[0].thumbnails.length>0?e.ikSlide.currentImage=e.ikSlide.media[0].provider_metadata[0].thumbnails[1].reference:e.ikSlide.currentImage="",void 0!==e.ikSlide.logo&&null!==e.ikSlide.logo?e.ikSlide.currentLogo=e.ikSlide.logo.urls.default_landscape:e.ikSlide.currentLogo="",n.getSlideTemplate(e.ikSlide.template).then(function(n){e.template=n,e.templateURL=e.template.paths.preview,e.theStyle={width:""+e.ikWidth+"px",height:""+parseFloat(e.template.ideal_dimensions.height*parseFloat(e.ikWidth/e.template.ideal_dimensions.width))+"px"},e.ikSlide.options.fontsize&&(e.theStyle.fontsize=""+parseFloat(e.ikSlide.options.fontsize*parseFloat(e.ikWidth/e.template.ideal_dimensions.width))+"px")},function(e){t.$emit("log.error",{cause:e,msg:"Hentning af templates fejlede."})}))})},template:'<div class="preview--slide" data-ng-style="{\'width\': theStyle.width}" data-ng-include="" src="templateURL"></div>'}}]),angular.module("ikApp").directive("ikSlideEditable",["templateFactory","busService",function(e,n){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikSlide:"="},link:function(t,r,i){t.templateURL="/app/shared/elements/slide/slide-loading.html?"+window.config.version,t.$watch("ikSlide",function(i,o){i&&("image"===t.ikSlide.media_type?(t.ikSlide.currentImage="",t.ikSlide.media.length>0&&(t.ikSlide.currentImage=t.ikSlide.media[0].urls.default_landscape)):"video"===t.ikSlide.media_type&&(t.ikSlide.currentVideo={mp4:"",ogg:"",webm:""},t.ikSlide.media.length>0&&void 0!==t.ikSlide.media[0]&&(t.ikSlide.media.length>0&&t.ikSlide.media[0].provider_metadata.length>0&&(t.ikSlide.currentVideo={},t.ikSlide.media[0].provider_metadata[0]&&(t.ikSlide.currentVideo.mp4=t.ikSlide.media[0].provider_metadata[0].reference),t.ikSlide.media[0].provider_metadata[1]&&(t.ikSlide.currentVideo.ogg=t.ikSlide.media[0].provider_metadata[1].reference),t.ikSlide.media[0].provider_metadata[2]&&(t.ikSlide.currentVideo.webm=t.ikSlide.media[0].provider_metadata[2].reference)),setTimeout(function(){r.find("#videoPlayer").load()},1e3))),t.ikSlide.currentLogo="",void 0!==t.ikSlide.logo&&null!==t.ikSlide.logo&&(t.ikSlide.currentLogo=t.ikSlide.logo.urls.default_landscape),t.template&&i.template===o.template||e.getSlideTemplate(t.ikSlide.template).then(function(e){t.template=e,t.templateURL=t.template.paths.edit,t.theStyle={width:""+t.ikWidth+"px",height:""+parseFloat(t.template.ideal_dimensions.height*parseFloat(t.ikWidth/t.template.ideal_dimensions.width))+"px",fontsize:""+parseFloat(t.ikSlide.options.fontsize*parseFloat(t.ikWidth/t.template.ideal_dimensions.width))+"px"}},function(e){n.$emit("log.error",{cause:e,msg:"Hentning af templates fejlede."})}),t.theStyle&&(t.theStyle.fontsize=""+parseFloat(t.ikSlide.options.fontsize*parseFloat(t.ikWidth/t.template.ideal_dimensions.width))+"px"))},!0)},templateUrl:"/app/shared/elements/slide/slide-edit.html?"+window.config.version}}]),angular.module("ikApp").directive("ikSlideOverview",["busService","$filter",function(e,n){"use strict";return{restrict:"E",scope:{ikSelectedSlides:"=",ikOverlay:"@"},controller:["$scope","slideFactory","userFactory",function(t,r,i){t.loading=!1,t.sort={created_at:"desc"},t.pager={size:6,page:0},t.hits=0,t.slides=[];var o={fields:["title"],text:t.search_text,sort:{created_at:{order:"desc"}},pager:t.pager};t.updateSearch=function(){o.text=t.search_text,t.loading=!0,r.searchSlides(o).then(function(n){t.hits=n.hits;for(var i=[],o=0;o<n.results.length;o++)i.push(n.results[o].id);r.loadSlidesBulk(i).then(function(e){t.slides=e,t.loading=!1},function(n){e.$emit("log.error",{cause:n,msg:"Hentning af søgeresultater fejlede."}),t.loading=!1})})},t.$on("slide-deleted",function(e){t.updateSearch()}),t.setUser=function(e){t.showFromUser!==e&&(t.showFromUser=e,t.setSearchFilters())},t.setSearchFilters=function(){if(delete o.filter,"all"!==t.showFromUser&&(o.filter={bool:{must:[]}}),"all"!==t.showFromUser){var e={};e.term={user:t.currentUser.id},o.filter.bool.must.push(e)}t.updateSearch()},t.slideSelected=function(e){if(!t.ikSelectedSlides)return!1;var n=!1;return t.ikSelectedSlides.forEach(function(t,r){t.id==e.id&&(n=!0)}),n},t.outOfSchedule=function(e){return!(!e.schedule_from||!e.schedule_to)&&!(1e3*e.schedule_from<Date.now()&&1e3*e.schedule_to>Date.now())},t.setSort=function(e,n){void 0!==t.sort[e]&&t.sort[e]===n||(t.sort={},t.sort[e]=n,o.sort={},o.sort[e]={order:n},t.updateSearch())},t.slideOverviewClickSlide=function(e){t.$emit("slideOverview.clickSlide",e)},t.slideScheduledNow=function(e){if(!e.published)return!1;var n=new Date;return n=parseInt(n.getTime()/1e3),!(e.hasOwnProperty("schedule_from")&&n<e.schedule_from)&&!(e.hasOwnProperty("schedule_to")&&n>e.schedule_to)},t.getScheduledText=function(e){var t="";return e.published||(t+="Ikke udgivet!<br/>"),e.hasOwnProperty("schedule_from")&&(t=t+"Udgivet fra: "+n("date")(1e3*e.schedule_from,"dd/MM/yyyy HH:mm")+".<br/>"),e.hasOwnProperty("schedule_to")&&(t=t+"Udgivet til: "+n("date")(1e3*e.schedule_to,"dd/MM/yyyy HH:mm")+"."),t},i.getCurrentUser().then(function(e){t.currentUser=e,t.showFromUser=t.currentUser.search_filter_default,t.setSearchFilters()})}],templateUrl:"/app/shared/elements/slideOverview/slide-overview-directive.html?"+window.config.version}}]),angular.module("ikApp").directive("ikChannelShare",[function(){"use strict";return{restrict:"E",scope:{ikChannel:"="},link:function(e){e.clickShare=function(){e.$emit("ikChannelShare.clickShare",e.ikChannel)}},templateUrl:"app/shared/elements/channelShare/channel-share.html?"+window.config.version}}]),angular.module("ikApp").directive("ikScreen",[function(){"use strict";return{restrict:"E",scope:{ikScreen:"="},link:function(e,n,t){t.$observe("ikScreen",function(n){n&&("landscape"===e.ikScreen.template.orientation?e.style={width:"300px",height:"168.5px"}:e.style={height:"300px",width:"168.5px"})})},templateUrl:"app/shared/elements/screen/screen-template.html?"+window.config.version}}]),angular.module("ikApp").directive("ikThumb",["$window",function(e){"use strict";var n={support:!(!e.FileReader||!e.CanvasRenderingContext2D),isFile:function(n){return angular.isObject(n)&&n instanceof e.File},isImage:function(e){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1);return"|jpg|png|jpeg|bmp|gif|".indexOf(n)!==-1}};return{restrict:"A",template:"<canvas/>",link:function(e,t,r){function i(e){var n=new Image;n.onload=o,n.src=e.target.result}function o(){var e=a.width?a.width:this.width/this.height*a.height,n=a.height?a.height:this.height/this.width*a.width;l.attr({width:e,height:n}),l[0].getContext("2d").drawImage(this,0,0,e,n)}if(n.support){var a=e.$eval(r.ikThumb);if(n.isFile(a.file)&&n.isImage(a.file)){var l=t.find("canvas"),s=new FileReader;s.onload=i,s.readAsDataURL(a.file)}}}}}]),function(){"use strict";var e;e=angular.module("itkChannelPickerWidget",[]),e.directive("channelPickerWidget",["userFactory","channelFactory","busService",function(e,n,t){return{restrict:"E",replace:!0,templateUrl:"app/shared/widgets/channelPickerWidget/channel-picker-widget.html?"+window.config.version,scope:{screen:"=",region:"="},link:function(r){r.sharingEnabled=window.config.sharingService.enabled,r.loading=!1,r.showFromUser="all",r.sort={created_at:"desc"},e.getCurrentUser().then(function(e){r.currentUser=e},function(e){t.$emit("log.error",{cause:e,msg:"Kunne ikke hente bruger."})}),r.pager={size:5,page:0},r.hits=0,r.channels=[];var i={fields:"title",text:"",filter:{bool:{must:[]}},sort:{created_at:{order:"desc"}},pager:r.pager};r.updateSearch=function(){i.text=r.search_text,r.loading=!0,n.searchChannels(i).then(function(e){r.hits=e.hits;for(var i=[],o=0;o<e.results.length;o++)i.push(e.results[o].id);n.loadChannelsBulk(i).then(function(e){r.channels=e,r.loading=!1},function(e){t.$emit("log.error",{cause:e,msg:"Kunne ikke hente søgeresultater."}),r.loading=!1})})},r.channelSelected=function(e){for(var n,t=0;t<r.screen.channel_screen_regions.length;t++)if(n=r.screen.channel_screen_regions[t],n.channel&&n.channel.id===e.id&&n.region===r.region)return!0;return!1},r.addChannel=function(e){r.screen.channel_screen_regions.push({id:null,screen_id:r.screen.id,channel:e,region:r.region})},r.removeChannel=function(e){for(var n,t=0;t<r.screen.channel_screen_regions.length;t++)n=r.screen.channel_screen_regions[t],n.channel&&n.channel.id===e.id&&n.region===r.region&&r.screen.channel_screen_regions.splice(t,1)},r.$watch("screen",function(e){e&&r.updateSearch()})}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkChannelRemoverWidget",[]),e.directive("channelRemoverWidget",[function(){return{restrict:"E",replace:!0,templateUrl:"app/shared/widgets/channelRemoverWidget/channel-remover-widget.html?"+window.config.version,scope:{screen:"=",region:"="},link:function(e){e.search_text="",e.getSearch=function(){return{title:e.search_text}},e.removeChannel=function(n){for(var t,r=0;r<e.screen.channel_screen_regions.length;r++)t=e.screen.channel_screen_regions[r],void 0===t.shared_channel&&t.channel.id===n.id&&t.region===e.region?e.screen.channel_screen_regions.splice(r,1):t.shared_channel&&t.shared_channel.unique_id===n.unique_id&&t.region===e.region&&e.screen.channel_screen_regions.splice(r,1)}}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkNumberWidget",[]),e.directive("numberWidget",function(){return{restrict:"E",scope:{field:"=",placeholderText:"@"},replace:!0,template:'<input type="number" class="cpw--text-input" placeholder="{{placeholderText}}" data-ng-model="field">'}})}.call(this),function(){"use strict";var e;e=angular.module("itkRegionPreviewWidget",[]),e.directive("regionPreviewWidget",[function(){return{restrict:"E",scope:{region:"=",screen:"=",width:"="},replace:!1,templateUrl:"app/shared/widgets/regionPreviewWidget/region-preview-widget.html?"+window.config.version,link:function(e){e.getNumberOfChannels=function(){for(var n=0,t=0;t<e.screen.channel_screen_regions.length;t++)e.screen.channel_screen_regions[t].region===e.region&&n++;return n}}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkScreenTemplatePickerWidget",[]),e.directive("screenTemplatePickerWidget",["templateFactory","busService",function(e,n){return{restrict:"E",scope:{screen:"="},replace:!0,link:function(t){t.templates=[],e.getScreenTemplates().then(function(e){t.templates=e},function(e){n.$emit("log.error",{cause:e,msg:"Kunne ikke loade templates."})}),t.pickTemplate=function(e){t.screen.template=angular.copy(e)}},templateUrl:"app/shared/widgets/screenTemplatePickerWidget/screenTemplatePickerWidget.html?"+window.config.version}}])}.call(this),function(){"use strict";var e;e=angular.module("itkSharedChannelPickerWidget",[]),
e.directive("sharedChannelPickerWidget",["sharedChannelFactory","busService",function(e,n){return{restrict:"E",replace:!0,templateUrl:"app/shared/widgets/sharedChannelPickerWidget/shared-channel-picker-widget.html?"+window.config.version,scope:{screen:"=",region:"="},link:function(t,r,i){t.index=null,t.loading=!1,t.pickIndexDialog=!1,t.sharingIndexes=[],e.getSharingIndexes().then(function(e){t.sharingIndexes=e},function(e){n.$emit("log.error",{cause:e,msg:"Kunne ikke hente delingsindeks."})}),t.showFromUser="all",t.sort={created_at:"desc"},t.pager={size:9,page:0},t.hits=0,t.channels=[];var o={fields:"title",text:"",filter:{bool:{must:[]}},sort:{created_at:{order:"desc"}},pager:t.pager};t.updateSearch=function(){null!==t.index&&(o.text=t.search_text,t.loading=!0,e.searchChannels(o,t.index.index).then(function(e){t.loading=!1,t.hits=e.hits,t.channels=e.results},function(e){n.$emit("log.error",{cause:e,msg:"Kunne ikke hente søgeresultater."}),t.loading=!1}))},t.setIndex=function(e){t.index=e,t.pickIndexDialog=!1,t.updateSearch()},t.channelSelected=function(e){for(var n,r=0;r<t.screen.channel_screen_regions.length;r++)if(n=t.screen.channel_screen_regions[r],n.shared_channel&&n.shared_channel.unique_id===e.unique_id&&n.region===t.region)return!0;return!1},t.addChannel=function(e){void 0!==e.index&&null!==e.index||(e.index=t.index.index),t.screen.channel_screen_regions.push({id:null,screen_id:t.screen.id,shared_channel:e,region:t.region})},t.removeChannel=function(e){for(var n,r=0;r<t.screen.channel_screen_regions.length;r++)n=t.screen.channel_screen_regions[r],n.shared_channel&&n.shared_channel.unique_id===e.unique_id&&n.region===t.region&&t.screen.channel_screen_regions.splice(r,1)},i.$observe("screen",function(e){e&&t.updateSearch()})}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkTextAreaWidget",[]),e.directive("textAreaWidget",function(){return{restrict:"E",scope:{field:"=",placeholderText:"@"},replace:!0,template:'<textarea class="cpw--textarea-input" data-ng-model="field" placeholder="{{placeholderText}}"></textarea>'}})}.call(this),function(){"use strict";var e;e=angular.module("itkTextWidget",[]),e.directive("textWidget",function(){return{restrict:"E",scope:{field:"=",placeholderText:"@"},replace:!0,template:'<input type="text" class="cpw--text-input" placeholder="{{placeholderText}}" data-ng-model="field">'}})}.call(this);