/**
 * @name Aroskanalen
 * @version v4.0.0
 * @link https://github.com/aroskanalen/admin
 */
angular.module("ikApp",["ngRoute","ngAnimate","angularFileUpload","colorpicker.module","datetimePicker","ngLocale","taiPlaceholder","ngModal","angular-dnd","720kb.tooltips","busModule","itkControlPanel","itkScreenTemplatePickerWidget","itkTextWidget","itkTextAreaWidget","itkNumberWidget","itkChannelPickerWidget","itkSharedChannelPickerWidget","itkChannelRemoverWidget","itkRegionPreviewWidget","itkDateComponent","itkDigitalClockComponent"],function(){}).config(["$sceDelegateProvider",function(e){"use strict";e.resourceUrlWhitelist(["self","**"])}]),angular.module("ikApp").config(["$routeProvider",function(e){"use strict";e.when("/",{redirectTo:"/channel-overview"}).when("/admin-sharing",{controller:"AdminSharingController",templateUrl:"app/pages/adminSharing/admin-sharing.html?"+window.config.version}).when("/admin-templates",{controller:"AdminTemplatesController",templateUrl:"app/pages/adminTemplates/admin-templates.html?"+window.config.version}).when("/channel-overview",{controller:"ChannelOverviewController",templateUrl:"app/pages/channelOverview/channel-overview.html?"+window.config.version}).when("/slide-overview",{controller:"SlideOverviewController",templateUrl:"app/pages/slideOverview/slide-overview.html?"+window.config.version}).when("/screen-overview",{controller:"ScreenOverviewController",templateUrl:"app/pages/screenOverview/screen-overview.html?"+window.config.version}).when("/media-overview",{controller:"MediaOverviewController",templateUrl:"app/pages/mediaOverview/media-overview.html?"+window.config.version}).when("/shared-channel-overview",{controller:"SharedChannelOverviewController",templateUrl:"app/pages/sharedChannelOverview/shared-channel-overview.html?"+window.config.version}).when("/screen",{controller:"ScreenController",templateUrl:"app/pages/screen/screen.html?"+window.config.version}).when("/screen/:id",{controller:"ScreenController",templateUrl:"app/pages/screen/screen.html?"+window.config.version}).when("/slide",{controller:"SlideController",templateUrl:"app/pages/slide/slide.html?"+window.config.version}).when("/slide/:id",{controller:"SlideController",templateUrl:"app/pages/slide/slide.html?"+window.config.version}).when("/shared-channel/:id/:index",{controller:"SharedChannelController",templateUrl:"app/pages/sharedChannel/shared-channel.html?"+window.config.version}).when("/channel",{controller:"ChannelController",templateUrl:"app/pages/channel/channel.html?"+window.config.version}).when("/channel/:id",{controller:"ChannelController",templateUrl:"app/pages/channel/channel.html?"+window.config.version}).when("/media/upload",{controller:"MediaUploadController",templateUrl:"app/pages/mediaUpload/media-upload.html?"+window.config.version}).when("/media/:id",{controller:"MediaEditController",templateUrl:"app/pages/mediaEdit/media-edit.html?"+window.config.version}).otherwise({template:""})}]),angular.module("ikApp").controller("AdminSharingController",["busService","sharedChannelFactory","$scope",function(e,t,n){"use strict";n.saving=!1,n.availableIndexes=[],t.getAvailableIndexes().then(function(e){e.forEach(function(e){"shared"===e.tag&&n.availableIndexes.push(e)})},function(t){e.$emit("log.error",{cause:t,msg:"Hentning af tilgængelige delingsindeks fejlede."})}),n.chosenIndexes=[],t.getSharingIndexes().then(function(e){n.chosenIndexes=e},function(t){e.$emit("log.error",{cause:t,msg:"Hentning af valgte delingsindeks fejlede."})}),n.save=function(){n.saving=!0,t.saveSharingIndexes(n.chosenIndexes).then(function(){e.$emit("log.info",{msg:"Delingsindeks gemt",timeout:3e3}),n.saving=!1},function(t){e.$emit("log.error",{cause:t,msg:"Delingsindeks blev ikke gemt."}),n.saving=!1})}}]),angular.module("ikApp").controller("AdminTemplatesController",["busService","templateFactory","$scope",function(e,t,n){"use strict";n.saving=!1,n.screenTemplates=[],n.slideTemplates=[],n.enabledScreenTemplates=[],n.enabledSlideTemplates=[],t.getAllScreenTemplates().then(function(e){n.screenTemplates=e;for(var t=[],r=0;r<e.length;r++)e[r].enabled&&t.push(e[r]);n.enabledScreenTemplates=t},function(t){e.$emit("log.error",{cause:t,msg:"Hentning af tilgængelige templates fejlede."})}),t.getAllSlideTemplates().then(function(e){n.slideTemplates=e;for(var t=[],r=0;r<e.length;r++)e[r].enabled&&t.push(e[r]);n.enabledSlideTemplates=t},function(t){e.$emit("log.error",{cause:t,msg:"Hentning af tilgængelige templates fejlede."})}),n.save=function(){n.saving=!0,t.saveEnabledTemplates(n.enabledScreenTemplates,n.enabledSlideTemplates).then(function(){e.$emit("log.info",{msg:"Template valg blev gemt",timeout:3e3}),n.saving=!1},function(t){e.$emit("log.error",{cause:t,msg:"Template valg blev ikke gemt"}),n.saving=!1})}}]),angular.module("ikApp").controller("ChannelOverviewController",["$scope","sharedChannelFactory","channelFactory","busService",function(e,t,n,r){"use strict";e.shareDialogShow=!1,e.shareDialogChannel=null,window.config.sharingService.enabled&&(e.$on("ikChannelShare.clickShare",function(t,i){e.shareDialogShow=!0,e.shareDialogChannel=i,n.getChannel(i.id).then(function(t){e.shareDialogChannel=t,e.shareDialogChannel.sharing_indexes||(e.shareDialogChannel.sharing_indexes=[])},function(e){r.$emit("log.error",{cause:e,msg:"Hentning af kanal fejlede"})})}),e.sharingIndexes=[],t.getSharingIndexes().then(function(t){e.sharingIndexes=t},function(e){r.$emit("log.error",{cause:e,msg:"Hentning af delingsindeks fejlede."})}),e.saveSharingChannel=function(){n.channelShare(e.shareDialogChannel).then(function(){r.$emit("log.info",{msg:"Delingskonfiguration af kanal lykkedes.",timeout:3e3})},function(e){r.$emit("log.error",{cause:e,msg:"Deling af kanal fejlede."})})})}]),angular.module("ikApp").controller("ChannelController",["$scope","$location","$routeParams","$timeout","$filter","channelFactory","slideFactory","busService",function(e,t,n,r,i,o,a,l){"use strict";function s(t){e.step=t,e.templatePath="/app/pages/channel/channel-step"+e.step+".html?"+window.config.version}function c(){n.id?null===n.id||void 0===n.id||""===n.id?t.path("/channel"):o.getEditChannel(n.id).then(function(n){e.channel=n,e.channel.status="edit-channel",e.channel==={}&&t.path("/channel"),s(2)},function(e){t.path("/channel-overview"),l.$emit("log.error",{cause:e,msg:"Hentning af valgt kanal med id:"+n.id+" fejlede"})}):(e.channel=o.emptyChannel(),s(1))}function d(t){return!!e.channel&&""!==e.channel[t]}function u(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function p(e){for(var t,n,r=e.length;0!==r;)n=Math.floor(Math.random()*r),r-=1,t=e[r],e[r]=e[n],e[n]=t;return e}e.steps=3,e.slides=[],e.channel={},e.days=[{id:1,name:"Mandag"},{id:2,name:"Tirsdag"},{id:3,name:"Onsdag"},{id:4,name:"Torsdag"},{id:5,name:"Fredag"},{id:6,name:"Lørdag"},{id:0,name:"Søndag"}],a.getSlides().then(function(t){e.slides=t},function(e){l.$emit("log.error",{cause:e,msg:"Hentning af slides fejlede"})}),e.editor={slideOverviewEditor:!1,toggleSlideOverviewEditor:function(){l.$emit("bodyService.toggleClass","is-locked"),e.editor.slideOverviewEditor=!e.editor.slideOverviewEditor}},e.$on("slideOverview.clickSlide",function(t,n){e.toggleSlide(n)}),c(),e.submitStep=function(){e.step===e.steps?(e.disableSubmitButton=!0,o.saveChannel().then(function(){l.$emit("log.info",{msg:"Kanal gemt.",timeout:3e3}),r(function(){t.path("/channel-overview")},1e3)},function(t){l.$emit("log.error",{cause:t,msg:"Gem af kanal fejlede."}),e.disableSubmitButton=!1})):s(e.step+1)},e.setOrientation=function(t){e.channel.orientation=t},e.slideSelected=function(t){var n=!1;return e.channel.slides.forEach(function(e){t===e.id&&(n=!0)}),n},e.validation={titleSet:function(){return d("title")},orientationSet:function(){return d("orientation")}},e.toggleSlide=function(t){var n=null;e.channel.slides.forEach(function(e,r){t.id===e.id&&(n=r)}),null!==n?e.channel.slides.splice(n,1):e.channel.slides.push(t)},e.slideScheduledNow=function(e){if(!e.published)return!1;var t=new Date;return t=parseInt(t.getTime()/1e3),!(e.hasOwnProperty("schedule_from")&&t<e.schedule_from)&&!(e.hasOwnProperty("schedule_to")&&t>e.schedule_to)},e.getScheduledText=function(e){var t="";return e.published||(t+="Ikke udgivet!<br/>"),e.hasOwnProperty("schedule_from")&&(t=t+"Udgivet fra: "+i("date")(1e3*e.schedule_from,"dd/MM/yyyy HH:mm")+".<br/>"),e.hasOwnProperty("schedule_to")&&(t=t+"Udgivet til: "+i("date")(1e3*e.schedule_to,"dd/MM/yyyy HH:mm")+"."),t},e.goToStep=function(t){var n=1;e.validation.titleSet()&&(n++,e.validation.orientationSet()&&(n+=3)),t<=n&&s(t)},e.pushRight=function(t){t===e.channel.slides.length-1?u(e.channel.slides,t,0):u(e.channel.slides,t,t+1)},e.pushLeft=function(t){0===t?u(e.channel.slides,t,e.channel.slides.length-1):u(e.channel.slides,t,t-1)},e.handleDrop=function(t,n){t=parseInt(t.split("index-")[1]),n=parseInt(n.split("index-")[1]);var r=e.channel.slides.splice(t,1);e.channel.slides.splice(n,0,r[0])},e.sortSlides=function(t){var n=e.lastSortUsed===t;return e.lastSortUsed=t,"random"===t?void(e.channel.slides=p(e.channel.slides)):void(e.channel.slides=i("orderBy")(e.channel.slides,n?"-":""+t))}}]),angular.module("ikApp").controller("MediaEditController",["$scope","$location","$routeParams","$timeout","mediaFactory","busService",function(e,t,n,r,i,o){"use strict";i.getMedia(n.id).then(function(n){e.media=n,e.media==={}&&t.path("/media-overview")},function(e){o.$emit("log.error",{cause:e,msg:"Kunne ikke hente media med id: "+n.id}),t.path("/media-overview")}),e["delete"]=function(){i.deleteMedia(e.media.id).then(function(){o.$emit("log.info",{msg:"Media slettet.",timeout:3e3}),r(function(){t.path("/media-overview")},500)},function(e){o.$emit("log.error",{cause:e,msg:"Sletning af media fejlede."})})},e.getContentType=function(e){if(!e)return"";var t=e.content_type.split("/");return t[0]},e.videoPath=function(e,t){var n="";return e.provider_metadata.forEach(function(e){e.format===t&&(n=e.reference),"thumbnail_landscape"===t&&e.thumbnails.forEach(function(e){"mp4_landscape"===e.label&&(n=e.reference)})}),n}}]),angular.module("ikApp").controller("MediaOverviewController",["$scope","$location",function(e,t){"use strict";e.$on("mediaOverview.selectMedia",function(e,n){t.path("/media/"+n.id)})}]),angular.module("ikApp").controller("MediaUploadController",["$scope",function(e){"use strict";e.$on("mediaUpload.uploadComplete",function(e,t){})}]),angular.module("ikApp").controller("ScreenController",["$scope","$location","$routeParams","$timeout","screenFactory","channelFactory","sharedChannelFactory","templateFactory","busService",function(e,t,n,r,i,o,a,l,s){"use strict";function c(){n.id?null===n.id||void 0===n.id||""===n.id?t.path("/screen-overview"):i.getEditScreen(n.id).then(function(n){e.loading=!1,e.screen=n,e.screen.channel_screen_regions.forEach(function(e){e.shared_channel&&(e.shared_channel.content=JSON.parse(e.shared_channel.content),e.shared_channel.title=e.shared_channel.content.title,e.shared_channel.slides=e.shared_channel.content.slides)}),e.screen==={}&&t.path("/screen")},function(e){s.$emit("log.error",{cause:e,msg:"Skærmen med id: "+n.id+" blev ikke fundet"})}):(e.screen=i.emptyScreen(),l.getScreenTemplate("full-screen").then(function(t){e.screen.template=t,e.loading=!1},function(t){404===t&&l.getScreenTemplates().then(function(t){e.screen.template=angular.copy(t[0]),e.screen.orientation=t[0].orientation,e.loading=!1},function(e){s.$emit("log.error",{cause:e,msg:"Skabelonerne blev ikke loaded"})})}))}e.loading=!0,e.sharingEnabled=window.config.sharingService.enabled,e.screen={},e.toolbarTemplate=null,e.display=!1,e.region=null,c(),e.saveScreenAndClose=function(){e.displayToolbar=!1,e.region=null,i.saveScreen().then(function(e){s.$emit("log.info",{msg:"Skærmen ("+e.title+") er gemt",timeout:5e3}),r(function(){t.path("/screen-overview")},1e3)},function(e){s.$emit("log.error",{cause:e,msg:"Skærmen blev ikke gemt"})})},e.saveScreen=function(){e.displayToolbar=!1,e.region=null,i.saveScreen().then(function(e){s.$emit("log.info",{msg:"Skærmen ("+e.title+") er gemt",timeout:5e3})},function(e){s.$emit("log.error",{cause:e,msg:"Skærmen blev ikke gemt"})})},e.triggerTool=function(t){e.screen.template.tools.hasOwnProperty(t.name)?e.toolbarTemplate=e.screen.template.tools[t.name]:e.toolbarTemplate="app/shared/toolbars/"+t.name+".html?"+window.config.version,e.region=t.region,e.displayToolbar=!0}}]),angular.module("ikApp").controller("ScreenOverviewController",["$scope","screenFactory","userFactory","busService",function(e,t,n,r){"use strict";e.loading=!1,e.sort={created_at:"desc"},e.pager={size:6,page:0},e.hits=0,e.screens=[];var i={fields:["title"],text:"",sort:{created_at:{order:"desc"}},pager:e.pager};e.updateSearch=function(){i.text=e.search_text,e.loading=!0,t.searchScreens(i).then(function(n){e.hits=n.hits;for(var i=[],o=0;o<n.results.length;o++)i.push(n.results[o].id);t.loadScreensBulk(i).then(function(t){e.screens=t,e.loading=!1},function(t){r.$emit("log.error",{cause:t,msg:"Kunne ikke hente søgeresultater."}),e.loading=!1})})},e.$on("screen-deleted",function(){e.updateSearch()}),e.setUser=function(t){localStorage.setItem("overview.screen.search_filter_default",t),e.showFromUser!==t&&(e.showFromUser=t,e.setSearchFilters())},e.setSearchFilters=function(){if(delete i.filter,"all"!==e.showFromUser&&(i.filter={bool:{must:[]}}),"all"!==e.showFromUser){var t={};t.term={user:e.currentUser.id},i.filter.bool.must.push(t)}e.updateSearch()},e.setSort=function(t,n){void 0!==e.sort[t]&&e.sort[t]===n||(e.sort={},e.sort[t]=n,i.sort={},i.sort[t]={order:n},e.updateSearch())},n.getCurrentUser().then(function(t){e.currentUser=t,e.showFromUser=localStorage.getItem("overview.screen.search_filter_default")?localStorage.getItem("overview.screen.search_filter_default"):"all",e.setSearchFilters()})}]),angular.module("ikApp").controller("SharedChannelController",["$scope","$location","$routeParams","$timeout","screenFactory","sharedChannelFactory","busService",function(e,t,n,r,i,o,a){"use strict";function l(t){e.step=t,e.templatePath="/app/pages/sharedChannel/shared-channel-step"+e.step+".html?"+window.config.version}function s(){n.id&&n.index?o.getSharedChannel(n.id,n.index).then(function(n){e.channel=JSON.parse(n.content),e.channel==={}&&t.path("/channel-sharing-overview"),l(1)},function(e){a.$emit("log.error",{cause:e,msg:"Delt kanal kunne ikke hentes."})}):t.path("/channel-sharing-overview")}e.steps=1,e.step=1,e.channel={},e.channel.slides=[],e.status="edit",i.getScreens().then(function(t){e.screens=t},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke hente skærme."})}),s(),e.submitStep=function(){t.path("/channel-sharing-overview")},e.goToStep=function(e){l(e)}}]),angular.module("ikApp").controller("SharedChannelOverviewController",["$scope",function(e){"use strict"}]),angular.module("ikApp").controller("SlideController",["$scope","$location","$routeParams","$timeout","slideFactory","templateFactory","channelFactory","busService",function(e,t,n,r,i,o,a,l){"use strict";function s(t){e.step=t,e.templatePath="/app/pages/slide/slide-step"+e.step+".html?"+window.config.version}function c(){a.getChannels().then(function(t){e.channels=t}),n.id?null===n.id||void 0===n.id||""===n.id?t.path("/slide"):(i.clearCurrentSlide(),i.getEditSlide(n.id).then(function(n){e.slide=n,e.slide.status="edit-slide",e.slide==={}&&t.path("/slide"),s(3)},function(e){l.$emit("log.error",{cause:e,msg:"Kunne ikke hente slide med id: "+n.id}),t.path("/slide-overview")})):(e.slide=i.emptySlide(),e.slide.channels=[],s(1))}function d(t){return!!e.slide&&""!==e.slide[t]}e.steps=5,e.slide={},e.templates=[],o.getSlideTemplates().then(function(t){for(var n in t)t.hasOwnProperty(n)&&e.templates.push(t[n])},function(e){l.$emit("log.error",{cause:e,msg:"Kunne ikke hente slide templates."})}),e.channels=[],e.editor={channelOverviewEditor:!1,toggleChannelOverviewEditor:function(){l.$emit("bodyService.toggleClass","is-locked"),e.editor.channelOverviewEditor=!e.editor.channelOverviewEditor}},e.$on("channelOverview.clickChannel",function(t,n){e.toggleChannel(n)}),c(),e.submitStep=function(){e.step===e.steps?(e.disableSubmitButton=!0,""===e.slide.duration&&(e.slide.duration=15),i.saveSlide().then(function(){l.$emit("log.info",{msg:"Slide er gemt",timeout:3e3}),r(function(){t.path("/slide-overview")},1e3)},function(t){l.$emit("log.error",{cause:t,msg:"Kunne ikke gemme slide"}),e.disableSubmitButton=!1})):s(e.step+1)},e.validation={titleSet:function(){return d("title")},templateSet:function(){return d("template")}},e.goToStep=function(t){var n=1;e.validation.titleSet()&&(n++,e.validation.templateSet()&&(n+=3)),t<=n&&s(t)},e.selectTemplate=function(t){e.slide.template=t;var n=null;e.templates.forEach(function(e){e.id===t&&(n=e)}),null!==n&&(e.slide.slide_type=n.slide_type,e.slide.options||(e.slide.options={}),e.slide.orientation=n.orientation,angular.forEach(n.empty_options,function(t,n){void 0===e.slide.options[n]&&(e.slide.options[n]=angular.copy(t))}),""===e.slide.options.headline&&(e.slide.options.headline=e.slide.title),e.slide.media_type=n.media_type)},e.channelSelected=function(t){var n=!1;return e.slide.channels.forEach(function(e){t.id===e.id&&(n=!0)}),n},e.hasChannel=function(t){var n=!1;return e.slide.channels.forEach(function(e){t.id===e.id&&(n=!0)}),n},e.toggleChannel=function(t){var n=null;e.slide.channels.forEach(function(e,r){t.id===e.id&&(n=r)}),null!==n?e.slide.channels.splice(n,1):e.slide.channels.push(t)}}]),angular.module("ikApp").controller("SlideEditController",["$scope","$http","$filter","mediaFactory","slideFactory","kobaFactory","busService","templateFactory",function(e,t,n,r,i,o,a,l){"use strict";function s(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}e.step="background-picker",e.addevent={title:null,place:null,from:null,to:null},i.getEditSlide(null).then(function(t){e.slide=t,l.getSlideTemplate(t.template).then(function(t){e.template=t},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke loade værktøjer til slidet."})})},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke hente slide."})}),e.openTool=function(t){a.$emit("bodyService.toggleClass","is-locked"),e.editor.editorOpen?(e.editor.editorOpen=!1,e.editorURL=""):("manual-calendar-editor"===t.id?(e.addevent.title=null,e.addevent.place=null,e.addevent.from=null,e.addevent.to=null,e.sortEvents()):"event-calendar-editor"===t.id&&(e.availableResources=[],o.getResources().then(function(t){if(e.availableResources=t,e.slide.options.hasOwnProperty("resources"))for(var n=[],r=e.slide.options.resources.length,i=0;i<r;i++){for(var o=!1,a=0;a<t.length;a++)if(t[a].mail===e.slide.options.resources[i].mail){o=!0;break}o&&n.push(e.slide.options.resources[i])}e.slide.options.resources=n},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke hente bookings for ressource."})})),e.editor.editorOpen=!0,t.path?e.editorURL=t.path+"?"+window.config.version:e.editorURL="templates/editors/"+t.id+".html?"+window.config.version)},e.editor={editorOpen:!1,hideEditors:function(){a.$emit("bodyService.removeClass","is-locked"),e.editor.editorOpen=!1,e.editorURL=""}},e.clickBackgroundColor=function(){e.slide.options.images=[]},e.addEventItem=function(){var t={title:e.addevent.title,place:e.addevent.place,from:e.addevent.from,to:e.addevent.to};e.slide.options.eventitems.push(t),e.addevent.title=null,e.addevent.place=null,e.addevent.from=null,e.addevent.to=null,t=null},e.removeEventItem=function(t){e.slide.options.eventitems.splice(e.slide.options.eventitems.indexOf(t),1)},e.sortEvents=function(){e.slide.options.eventitems.length>0&&(e.slide.options.eventitems=n("orderBy")(e.slide.options.eventitems,"from"))},e.eventIsOutdated=function(e){var t=e.to,n=e.from,r=Date.now()/1e3;return t&&r>t||!t&&r>n},e.addCalendarEvents=function(){for(var t=[],n=function(e){for(var n=0;n<e.length;n++){var r=e[n];t.push(r)}},r=0;r<e.slide.options.resources.length;r++){var i=e.slide.options.resources[r],l=new Date,s=new Date(l.getFullYear(),l.getMonth(),l.getDate()).getTime()/1e3,c=s+86400;o.getBookingsForResource(i.mail,s,c).then(n,function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke hente bookings for ressource."})})}e.slide.external_data=t};var c=function(t){for(var n=[],r=!1,i=0;i<e.slide.media.length;i++){var o=e.slide.media[i];o.id!==t.id?"slideshow"===e.slide.slide_type&&n.push(o):r=!0}r||n.push(t),e.slide.media=n};e.$on("mediaOverview.selectMedia",function(t,n){"logo"===n.media_type?(e.slide.logo=n,e.logoStep="logo-picker"):c(n)}),e.$on("mediaUpload.uploadSuccess",function(t,n){r.getMedia(n.id).then(function(t){"logo"===t.media_type?(e.slide.logo=t,e.logoStep="logo-picker"):"slideshow"===e.slide.slide_type?e.slide.media.push(t):e.slide.media=[t]},function(e){a.$emit("log.error",{cause:e,msg:"Kunne ikke tilføje media."})});var i=n.queue.find(function(e,t){return!e.isSuccess});i||e.editor.hideEditors()}),e.step="background-picker",e.pushMediaRight=function(t){t===e.slide.media.length-1?s(e.slide.media,t,0):s(e.slide.media,t,t+1)},e.pushMediaLeft=function(t){0===t?s(e.slide.media,t,e.slide.media.length-1):s(e.slide.media,t,t-1)},e.removeMedia=function(t){e.slide.media.splice(t,1)},e.backgroundPicker=function(){e.step="background-picker"},e.pickFromMedia=function(){e.step="pick-from-media",e.$emit("mediaOverview.updateSearch")},e.pickFromComputer=function(){e.step="pick-from-computer"},e.logoStep="logo-picker",e.logoPicker=function(){e.logoStep="logo-picker"},e.pickLogoFromMedia=function(){e.logoStep="pick-logo-from-media",e.$emit("mediaOverview.updateSearch")},e.pickLogoFromComputer=function(){e.logoStep="pick-logo-from-computer"},e.logoPositions=[{value:{top:"0",bottom:"auto",left:"0",right:"auto"},text:"top venstre"},{value:{top:"0",bottom:"auto",left:"auto",right:"0"},text:"top højre"},{value:{top:"auto",bottom:"0",left:"0",right:"auto"},text:"bund venstre"},{value:{top:"auto",bottom:"0",left:"auto",right:"0"},text:"bund højre"}],e.logoSizes=[{value:"5%",text:"Meget lille (5% af skærmen)"},{value:"10%",text:"Lille (10% af skærmen)"},{value:"15%",text:"Medium (15% af skærmen)"},{value:"20%",text:"Stor (20% af skærmen)"},{value:"40%",text:"Ekstra stor (40% af skærmen)"}],e.handleDropMedia=function(t,n){t=parseInt(t.split("index-")[1]),n=parseInt(n.split("index-")[1]);var r=e.slide.media.splice(t,1);e.slide.media.splice(n,0,r[0])}}]),angular.module("ikApp").controller("SlideOverviewController",["$scope","$location",function(e,t){"use strict";e.$on("slideOverview.clickSlide",function(e,n){t.path("/slide/"+n.id)})}]),angular.module("ikApp").filter("activeEvents",function(){"use strict";return function(e){if(!angular.isArray(e))return!1;for(var t=parseInt(Date.now()/1e3),n=[],r=0;r<e.length;r++){var i=e[r];i.from&&i.to&&i.to>=t?n.push(i):i.from&&i.from>=t&&n.push(i)}return n}}),angular.module("ikApp").factory("authHttpResponseInterceptor",["$q","$location","$window",function(e,t,n){"use strict";return{responseError:function(t){return 401===t.status&&(n.location.href="/logout"),e.reject(t)}}}]),angular.module("ikApp").config(["$httpProvider",function(e){"use strict";e.interceptors.push("authHttpResponseInterceptor")}]),angular.module("ikApp").factory("channelFactory",["$http","$q","busService",function(e,t,n){"use strict";var r={},i={};return r.searchChannels=function(e){var r=t.defer();e.type="Indholdskanalen\\MainBundle\\Entity\\Channel";var i=CryptoJS.MD5(JSON.stringify(e)).toString();return e.callbacks={hits:"searchService.hits-"+i,error:"searchService.error-"+i},n.$once(e.callbacks.hits,function(e,t){r.resolve(t)}),n.$once(e.callbacks.error,function(e,t){n.$emit("log.error",{cause:t,msg:"Kunne ikke hente søgeresultater."}),r.reject(t)}),n.$emit("searchService.request",e),r.promise},r.getChannels=function(){var n=t.defer();return e.get("/api/channel").success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},r.loadChannelsBulk=function(n){var r=t.defer(),i="?ids[]="+n.join("&ids[]=");return e.get("/api/bulk/channel/api-bulk"+i).success(function(e,t){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r.getEditChannel=function(n){var r=t.defer();return null===n||void 0===n||""===n?r.resolve(i):e.get("/api/channel/"+n).success(function(e){i=e,r.resolve(i)}).error(function(){r.reject()}),r.promise},r.getChannel=function(n){var r=t.defer();return e.get("/api/channel/"+n).success(function(e){r.resolve(e)}).error(function(){r.reject()}),r.promise},r.emptyChannel=function(){return i={id:null,title:"",orientation:"",created_at:parseInt((new Date).getTime()/1e3),slides:[],screens:[],sharing_indexes:[],schedule_repeat_days:[]}},r.saveChannel=function(){var n=t.defer();return e.post("/api/channel",i).success(function(){n.resolve("success"),i=null}).error(function(){n.reject("error")}),n.promise},r.channelShare=function(n){var r=t.defer();return e.post("/api/channel/share",n).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r}]),angular.module("ikApp").factory("kobaFactory",["$http","$q",function(e,t){"use strict";var n={};return n.getResources=function(){var n=t.defer();return e.get("/api/koba/resources").success(function(e){n.resolve(e)}).error(function(e,t){n.reject(t)}),n.promise},n.getBookingsForResource=function(n,r,i){var o=t.defer();return e.get("/api/koba/resources/"+n+"/bookings/from/"+r+"/to/"+i).success(function(e){o.resolve(e)}).error(function(e,t){o.reject(t)}),o.promise},n}]),angular.module("ikApp").factory("mediaFactory",["$http","$q","busService",function(e,t,n){"use strict";var r={};return r.getAllMedia=function(){var n=t.defer();return e.get("/api/media").success(function(e){n.resolve(e)}).error(function(){n.reject()}),n.promise},r.searchMedia=function(e){var r=t.defer();e.type="Application\\Sonata\\MediaBundle\\Entity\\Media";var i=CryptoJS.MD5(JSON.stringify(e)).toString();return e.callbacks={hits:"searchService.hits-"+i,error:"searchService.error-"+i},n.$once(e.callbacks.hits,function(e,t){r.resolve(t)}),n.$once(e.callbacks.error,function(e,t){n.$emit("log.error",{cause:t,msg:"Kunne ikke hente søgeresultater."}),r.reject(t)}),n.$emit("searchService.request",e),r.promise},r.loadMediaBulk=function(n){var r=t.defer(),i="?ids[]="+n.join("&ids[]=");return e.get("/api/bulk/media/api"+i).success(function(e,t){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r.getMedia=function(n){var r=t.defer();return e.get("/api/media/"+n).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r.deleteMedia=function(n){var r=t.defer();return e["delete"]("/api/media/"+n).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r}]),angular.module("ikApp").factory("screenFactory",["$http","$q","busService",function(e,t,n){"use strict";var r={},i=null;return r.searchScreens=function(e){var r=t.defer();e.type="Indholdskanalen\\MainBundle\\Entity\\Screen";var i=CryptoJS.MD5(JSON.stringify(e)).toString();return e.callbacks={hits:"searchService.hits-"+i,error:"searchService.error-"+i},n.$once(e.callbacks.hits,function(e,t){r.resolve(t)}),n.$once(e.callbacks.error,function(e,t){n.$emit("log.error",{cause:t,msg:"Kunne ikke hente søgeresultater."}),r.reject(t)}),n.$emit("searchService.request",e),r.promise},r.getScreens=function(){var n=t.defer();return e.get("/api/screen").success(function(e){n.resolve(e)}).error(function(e,t){n.reject(t)}),n.promise},r.loadScreensBulk=function(n){var r=t.defer(),i="?ids[]="+n.join("&ids[]=");return e.get("/api/bulk/screen/api"+i).success(function(e,t){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r.getEditScreen=function(n){var r=t.defer();return null===n||void 0===n||""===n?r.resolve(i):e.get("/api/screen/"+n).success(function(e){i=e,r.resolve(i)}).error(function(e,t){r.reject(t)}),r.promise},r.getScreen=function(n){var r=t.defer();return e.get("/api/screen/"+n).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r.saveScreen=function(){var n=t.defer();return null===i?n.reject(404):e.post("/api/screen",i).success(function(e){i.id=e,n.resolve(i)}).error(function(e,t){n.reject(t)}),n.promise},r.emptyScreen=function(){return i={id:null,template:null,description:"",title:"",orientation:"landscape",width:1920,height:1080,channel_screen_regions:[],options:{}}},r}]),angular.module("ikApp").factory("sharedChannelFactory",["$http","$q","sharedSearchFactory",function(e,t,n){"use strict";var r={},i=null;return r.searchChannels=function(e,t){return e.type="Indholdskanalen\\MainBundle\\Entity\\Channel",n.search(e,t)},r.getSharedChannel=function(n,r){var i=t.defer();return e.get("/api/sharing/channel/"+n+"/"+r).success(function(e){i.resolve(e)}).error(function(e,t){i.reject(t)}),i.promise},r.saveSharedChannel=function(n){var r=t.defer();return e.post("/api/sharing/channel",n).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r.getAvailableIndexes=function(){var n=t.defer();return null!==i?n.resolve(i):e.get("/api/sharing/available_indexes").success(function(e){i=e,n.resolve(e)}).error(function(e,t){n.reject(t)}),n.promise},r.saveSharingIndexes=function(n){var r=t.defer();return e.post("/api/sharing/indexes",n).success(function(e){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r.getSharingIndexes=function(){var n=t.defer();return e.get("/api/sharing/indexes").success(function(e){n.resolve(e)}).error(function(e,t){n.reject(t)}),n.promise},r}]),angular.module("ikApp").service("sharedSearchFactory",["$q","$rootScope","$http","busService",function(e,t,n,r){"use strict";function i(e){a=io.connect(window.config.sharingService.address,{query:"token="+l,"force new connection":!0,"max reconnection attempts":1/0}),a.on("error",function(t){"Not authorized"===t?n.get("api/auth/sharing/reauth").success(function(t){l=t.token,i(e)}).error(function(t,n){r.$emit("log.error",{cause:n,msg:"Search socket error. Could not reauthorize."}),e.reject(n)}):(r.$emit("log.error",{cause:t,msg:"Search socket error."}),e.reject(t))}),a.on("connect",function(){e.resolve("Connected to the server.")}),a.on("disconnect",function(e){})}function o(){var t=e.defer();return void 0===a?null!==l?i(t):n.get("api/auth/sharing").success(function(e){l=e.token,i(t)}).error(function(e,n){r.$emit("log.error",{cause:n,msg:"Authentication (sharing) to search node failed ("+n+")"}),t.reject(n)}):t.resolve("Connected to the server."),t.promise}var a,l=null;this.search=function(t,n){var i=e.defer(),l={index:n,type:t.type,query:{match_all:{}}};return void 0!==t.text&&""!==t.text&&(l.query={multi_match:{query:t.text,type:"best_fields",operator:"or",fields:t.fields,analyzer:"string_search"}}),l.sort=t.sort,void 0!==t.filter&&(l.query={filtered:{query:l.query,filter:t.filter}}),t.hasOwnProperty("pager")&&(l.size=t.pager.size,l.from=t.pager.page*t.pager.size),l.uuid=CryptoJS.MD5(JSON.stringify(l)).toString(),l.callbacks={hits:"hits-"+l.uuid,error:"error-"+l.uuid},o().then(function(){a.emit("search",l),a.once(l.callbacks.hits,function(e){i.resolve(e)}),a.once(l.callbacks.error,function(e){r.$emit("log.error",{cause:e.message,msg:"Search error"}),i.reject(e.message)})}),i.promise}}]),angular.module("ikApp").factory("slideFactory",["$http","$q","busService",function(e,t,n){"use strict";var r={},i=null;return r.searchSlides=function(e){var r=t.defer();e.type="Indholdskanalen\\MainBundle\\Entity\\Slide";var i=CryptoJS.MD5(JSON.stringify(e)).toString();return e.callbacks={hits:"searchService.hits-"+i,error:"searchService.error-"+i},n.$once(e.callbacks.hits,function(e,t){r.resolve(t)}),n.$once(e.callbacks.error,function(e,t){n.$emit("log.error",{cause:t,msg:"Kunne ikke hente søgeresultater."}),r.reject(t)}),n.$emit("searchService.request",e),r.promise},r.getSlides=function(){var n=t.defer();return e.get("/api/slide").success(function(e,t){n.resolve(e)}).error(function(e,t){n.reject(t)}),n.promise},r.loadSlidesBulk=function(n){var r=t.defer(),i="?ids[]="+n.join("&ids[]=");return e.get("/api/bulk/slide/api-bulk"+i).success(function(e,t){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r.clearCurrentSlide=function(){i=null},r.getEditSlide=function(n){var r=t.defer();return null===n||void 0===n||""===n?r.resolve(i):null!==i&&i.id==n?r.resolve(i):e.get("/api/slide/"+n).success(function(e,t){
i=e,r.resolve(i)}).error(function(e,t){r.reject(t)}),r.promise},r.getSlide=function(n){var r=t.defer();return e.get("/api/slide/"+n).success(function(e,t){r.resolve(e)}).error(function(e,t){r.reject(t)}),r.promise},r.saveSlide=function(){var n=t.defer();return e.post("/api/slide",i).success(function(e){n.resolve(e),i=null}).error(function(e,t){n.reject(t)}),n.promise},r.emptySlide=function(){return i={id:null,published:!0,schedule_from:null,schedule_to:null,media:[],media_type:null,title:"",user:"",duration:"",orientation:"",template:"",options:null}},r}]),angular.module("ikApp").factory("templateFactory",["$q","$http",function(e,t){"use strict";var n={},r=null,i=null;return n.getSlideTemplates=function(){var n=e.defer();return null!==r?n.resolve(r):t.get("/api/templates/slides/enabled").success(function(e){r=e,n.resolve(r)}).error(function(e,t){n.reject(t)}),n.promise},n.getSlideTemplate=function(t){var r=e.defer();return n.getSlideTemplates().then(function(e){for(var n=0;n<e.length;n++)if(e[n].id===t)return void r.resolve(e[n]);r.reject(404)},function(e){r.reject(e)}),r.promise},n.getScreenTemplates=function(){var n=e.defer();return null!==i?n.resolve(i):t.get("/api/templates/screens/enabled").success(function(e){i=e,n.resolve(i)}).error(function(e,t){n.reject(t)}),n.promise},n.getScreenTemplate=function(t){var r=e.defer();return n.getScreenTemplates().then(function(e){for(var n=0;n<e.length;n++)if(e[n].id===t)return void r.resolve(e[n]);r.reject(404)},function(e){r.reject(e)}),r.promise},n.saveEnabledTemplates=function(n,o){var a=e.defer();return t.post("/api/templates/save/enabled",{screens:n,slides:o}).success(function(e,n){t.get("/api/templates/slides/enabled").success(function(e){r=e}).error(function(e,t){}),t.get("/api/templates/screens/enabled").success(function(e){i=e}).error(function(e,t){}),a.resolve(n)}).error(function(e,t){a.reject(t)}),a.promise},n.getAllSlideTemplates=function(){var n=e.defer();return t.get("/api/templates/slides/all").success(function(e){r=e,n.resolve(r)}).error(function(e,t){n.reject(t)}),n.promise},n.getAllScreenTemplates=function(){var n=e.defer();return t.get("/api/templates/screens/all").success(function(e){r=e,n.resolve(r)}).error(function(e,t){n.reject(t)}),n.promise},n}]),angular.module("ikApp").factory("userFactory",["$http","$q",function(e,t){"use strict";var n,r={};return r.getCurrentUser=function(){var r=t.defer();return void 0===n?e.get("/api/user/current").success(function(e){n=e,r.resolve(e)}).error(function(){r.reject()}):r.resolve(n),r.promise},r}]),function(){"use strict";var e;e=angular.module("itkDateComponent",[]),e.directive("dateComponent",["$interval",function(e){return{restrict:"E",replace:!0,templateUrl:"app/shared/components/date/date.html?"+window.config.version,scope:{theme:"@"},link:function(t){t.thisDate=new Date;var n=e(function(){t.thisDate=new Date},6e4);t.$on("$destroy",function(){angular.isDefined(n)&&(e.cancel(n),n=void 0)})}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkDigitalClockComponent",[]),e.directive("digitalClockComponent",["$interval",function(e){return{restrict:"E",replace:!0,templateUrl:"app/shared/components/digital-clock/digital-clock.html?"+window.config.version,scope:{},link:function(t){t.thisDate=new Date;var n=e(function(){t.thisDate=Date.now()},1e3);t.$on("$destroy",function(){angular.isDefined(n)&&(e.cancel(n),n=void 0)})}}}])}.call(this),angular.module("ikApp").directive("ikActionReloadScreen",["$http","busService",function(e,t){"use strict";return{restrict:"E",replace:!1,scope:{id:"@"},link:function(n){n.reloadScreen=function(){var r=window.confirm("Er du sikker på at du vil genindlæse skærmen?");r===!0&&e.post("/api/screen/"+n.id+"/reload").success(function(){t.$emit("log.info",{msg:"Genindlæsning lykkedes.",timeout:3e3})}).error(function(e){t.$emit("log.error",{cause:e,msg:"Genindlæsning lykkedes ikke! Dette kan skyldes at skærmen ikke er forbundet."})})}},templateUrl:"app/shared/elements/actionReloadScreen/action-reload-screen.html?"+window.config.version}}]),angular.module("ikApp").directive("ikActionsMenu",[function(){"use strict";return{restrict:"E",replace:!1,transclude:!0,scope:{},link:function(e){e.menuOpen=!1,e.toggleMenu=function(){e.menuOpen=!e.menuOpen}},templateUrl:"app/shared/elements/actionsMenu/actions-menu.html?"+window.config.version}}]),angular.module("ikApp").directive("ikChannel",["$interval","$location",function(e,t){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikChannel:"=",ikSingleSlide:"=",ikClickable:"="},link:function(n,r,i){n.slideIndex=0,n.playText="",i.$observe("ikChannel",function(e){e&&(n.ikChannel.slides.length<=0?n.templateURL="app/shared/elements/channel/empty.html?"+window.config.version:(n.templateURL="app/shared/elements/channel/non-empty.html?"+window.config.version,n.buttonState="play"))}),n.play=function(){angular.isDefined(n.interval)?(e.cancel(n.interval),n.interval=void 0,n.buttonState="play"):(n.slideIndex=(n.slideIndex+1)%n.ikChannel.slides.length,n.interval=e(function(){n.slideIndex=(n.slideIndex+1)%n.ikChannel.slides.length},2e3),n.buttonState="pause")},n.redirectToChannel=function(){n.ikClickable&&t.path("/channel/"+n.ikChannel.id)},n.$on("$destroy",function(){angular.isDefined(n.interval)&&(e.cancel(n.interval),n.interval=void 0)})},templateUrl:"app/shared/elements/channel/channel-template.html?"+window.config.version}}]),angular.module("ikApp").directive("autoGrow",function(){"use strict";return{restrict:"A",scope:{fontSize:"@"},link:function(e,t){var n=$(t),r=function(e){e.css("height","0px");var t=e.prop("scrollHeight"),n=e.css("min-height").replace("px","");e.css("height",Math.max(t,n)+"px")};t.bind("keyup",function(){r(n)}),e.$watch("fontSize",function(e){e&&r(n)}),setTimeout(function(){r(n)},100)}}}),angular.module("ikApp").directive("ikChannelOverview",["channelFactory","userFactory","busService","$filter",function(e,t,n,r){"use strict";return{restrict:"E",scope:{ikSelectedChannels:"=",ikOverlay:"@"},link:function(i){i.displaySharingOption=window.config.sharingService.enabled,i.loading=!1,i.sort={created_at:"desc"},i.pager={size:6,page:0},i.hits=0,i.channels=[];var o={fields:"title",text:"",filter:{bool:{must:[]}},sort:{created_at:{order:"desc"}},pager:i.pager};i.updateSearch=function(){o.text=i.search_text,i.loading=!0,e.searchChannels(o).then(function(t){i.hits=t.hits;for(var r=[],o=0;o<t.results.length;o++)r.push(t.results[o].id);e.loadChannelsBulk(r).then(function(e){i.channels=e,i.loading=!1},function(e){n.$emit("log.error",{cause:e,msg:"Kunne ikke loade søgeresultatet."}),i.loading=!1})})},i.$on("channel-deleted",function(){i.updateSearch()}),i.channelSelected=function(e){if(!i.ikSelectedChannels)return!1;var t=!1;return i.ikSelectedChannels.forEach(function(n){n.id===e.id&&(t=!0)}),t},i.channelOverviewClickChannel=function(e){i.$emit("channelOverview.clickChannel",e)},i.setUser=function(e){localStorage.setItem("overview.channel.search_filter_default",e),i.showFromUser!==e&&(i.showFromUser=e,i.setSearchFilters())},i.setSearchFilters=function(){delete o.filter,"all"!==i.showFromUser&&(o.filter={bool:{must:[]}});var e={};"all"!==i.showFromUser&&(e.term={user:i.currentUser.id},o.filter.bool.must.push(e)),i.updateSearch()},i.setSort=function(e,t){void 0!==i.sort[e]&&i.sort[e]===t||(i.sort={},i.sort[e]=t,o.sort={},o.sort[e]={order:t},i.updateSearch())},i.channelScheduledNow=function(e){var t=new Date,n=t.getDay(),r=t.getHours();if(t=parseInt(t.getTime()/1e3),e.hasOwnProperty("publish_from")&&t<e.publish_from)return!1;if(e.hasOwnProperty("publish_to")&&t>e.publish_to)return!1;if(e.hasOwnProperty("schedule_repeat")&&e.schedule_repeat){if(!(e.hasOwnProperty("schedule_repeat_days")&&e.schedule_repeat_days.length>0))return!1;for(var i=0;i<e.schedule_repeat_days.length;i++)if(n===e.schedule_repeat_days[i].id){if(e.hasOwnProperty("schedule_repeat_from")&&r<e.schedule_repeat_from)return!1;if(e.hasOwnProperty("schedule_repeat_to")&&r>e.schedule_repeat_to)return!1}}return!0},i.getScheduledText=function(e){var t="";if(e.hasOwnProperty("publish_from")&&(t=t+"Udgivet fra: "+r("date")(1e3*e.publish_from,"dd/MM/yyyy HH:mm")+".<br/>"),e.hasOwnProperty("publish_to")&&(t=t+"Udgivet til: "+r("date")(1e3*e.publish_to,"dd/MM/yyyy HH:mm")+".<br/>"),e.hasOwnProperty("schedule_repeat")&&e.schedule_repeat){t+="Vises disse dage:<br/>";for(var n=0;n<e.schedule_repeat_days.length;n++)t=t+e.schedule_repeat_days[n].name+" ";t+="<br/>",e.hasOwnProperty("schedule_repeat_from")&&(t=t+"Fra: "+e.schedule_repeat_from+":00<br/>"),e.hasOwnProperty("schedule_repeat_to")&&(t=t+"Til: "+e.schedule_repeat_to+":00<br/>")}return t},t.getCurrentUser().then(function(e){i.currentUser=e,i.showFromUser=localStorage.getItem("overview.channel.search_filter_default")?localStorage.getItem("overview.channel.search_filter_default"):"all",i.setSearchFilters()})},templateUrl:"/app/shared/elements/channelOverview/channel-overview-directive.html?"+window.config.version}}]),angular.module("ikApp").directive("ikChannelShare",[function(){"use strict";return{restrict:"E",scope:{ikChannel:"="},link:function(e){e.clickShare=function(){e.$emit("ikChannelShare.clickShare",e.ikChannel)}},templateUrl:"app/shared/elements/channelShare/channel-share.html?"+window.config.version}}]),angular.module("ikApp").directive("ikChecklist",[function(){"use strict";return{restrict:"E",replace:!1,scope:{elements:"=",selected:"=",identity:"="},link:function(e){e.toggleElement=function(t){if(e.selected){var n=-1;e.selected.forEach(function(r,i){r[e.identity]===t[e.identity]&&(n=i)}),n>-1?e.selected.splice(n,1):e.selected.push(t)}},e.elementSelected=function(t){if(!e.selected)return!1;for(var n=0;n<e.selected.length;n++)if(e.selected[n][e.identity]===t[e.identity])return!0;return!1}},templateUrl:"app/shared/elements/checklist/checklist.html?"+window.config.version}}]),function(){"use strict";var e;e=angular.module("itkControlPanel",[]),e.directive("controlPanel",["busService",function(e){return{restrict:"E",scope:{template:"=",data:"=",display:"=",saveAction:"&",region:"=",options:"="},replace:!0,link:function(t){t.selectedTab=null,e.$emit("bodyService.addClass","is-screen"),t.getContent=function(){return t.template},t.clickTab=function(e){t.selectedTab=e},t.toggleChannelType=function(e){t.channelType=e},t.$on("$destroy",function(){document.getElementsByTagName("body")[0].style.overflow=""})},template:'<div data-ng-include="getContent()"></div>'}}])}.call(this),angular.module("ikApp").directive("ikDelete",["$http","$rootScope","busService",function(e,t,n){"use strict";return{restrict:"E",replace:!1,scope:{id:"@",type:"@"},link:function(r){r.remove=function(){var i=window.confirm("Er du sikker på du vil slette dette? Handlingen kan ikke fortrydes.");i===!0&&e["delete"]("/api/"+r.type+"/"+r.id).success(function(){n.$emit("log.info",{msg:"Sletning lykkes.",timeout:3e3}),t.$broadcast(r.type+"-deleted",{})}).error(function(e){n.$emit("log.error",{cause:e,msg:"Sletning lykkes ikke!"})})}},templateUrl:"app/shared/elements/delete/delete.html?"+window.config.version}}]),angular.module("ikApp").directive("includeReplace",function(){"use strict";return{require:"ngInclude",restrict:"A",link:function(e,t){t.replaceWith(t.children())}}}),angular.module("ikApp").directive("ikMediaOverview",["busService",function(e){"use strict";return{restrict:"E",scope:{ikMediaType:"@",ikAutoSearch:"@",ikHideFilters:"=",ikSelectedMedia:"="},controller:["$scope","mediaFactory","userFactory",function(t,n,r){t.sort={created_at:"desc"},t.loading=!1,t.search_text="",t.media_type="all",t.media=[],t.pager={size:6,page:0},t.hits=0;var i={fields:"name",text:"",sort:{created_at:{order:"desc"}},pager:t.pager};t.updateSearch=function(){i.text=t.search_text,t.loading=!0,n.searchMedia(i).then(function(r){t.hits=r.hits;for(var i=[],o=0;o<r.results.length;o++)i.push(r.results[o].id);n.loadMediaBulk(i).then(function(e){t.media=e,t.loading=!1},function(n){e.$emit("log.error",{cause:n,msg:"Hentning af søgeresultater fejlede."}),t.loading=!1})})},t.mediaSelected=function(e){if(!t.ikSelectedMedia)return!1;var n=!1;return t.ikSelectedMedia.forEach(function(t){t.id===e.id&&(n=!0)}),n},t.filterMediaType=function(e){t.media_type!==e&&(t.media_type=e,t.setSearchFilters())},t.setSearchFilters=function(){if(delete i.filter,"all"===t.media_type&&"all"===t.showFromUser||(i.filter={bool:{must:[]}}),"all"!==t.media_type){var e={};e.term={media_type:t.media_type},i.filter.bool.must.push(e)}if("all"!==t.showFromUser&&t.currentUser){var e={};e.term={user:t.currentUser.id},i.filter.bool.must.push(e)}t.updateSearch()},t.setUser=function(e){localStorage.setItem("overview.media.search_filter_default",e),t.showFromUser!==e&&(t.showFromUser=e,t.setSearchFilters())},t.setSort=function(e,n){void 0!==t.sort[e]&&t.sort[e]===n||(t.sort={},t.sort[e]=n,i.sort={},i.sort[e]={order:n},t.updateSearch())},t.mediaOverviewClickMedia=function(e){t.$emit("mediaOverview.selectMedia",e)},t.$on("mediaOverview.updateSearch",function(e){t.updateSearch(),e.preventDefault()}),r.getCurrentUser().then(function(e){t.currentUser=e,t.showFromUser=localStorage.getItem("overview.media.search_filter_default")?localStorage.getItem("overview.media.search_filter_default"):"all",t.setSearchFilters()})}],link:function(e,t,n){n.$observe("ikMediaType",function(t){t&&t!=e.media_type&&e.filterMediaType(t)})},templateUrl:"/app/shared/elements/mediaOverview/media-overview-directive.html?"+window.config.version}}]),angular.module("ikApp").directive("ikMediaUpload",[function(){"use strict";return{restrict:"E",scope:{ikUploadType:"@",queueLimit:"="},controller:["$scope","FileUploader",function(e,t){e.currentStep=1,e.uploadComplete=!1,e.uploadErrors=!1,e.uploadInProgress=!1,e.uploadErrorText="";var n="|mp4|x-msvideo|x-ms-wmv|quicktime|mpeg|mpg|x-matroska|ogg|webm",r="|jpg|png|jpeg|bmp|gif",i="";i="image"===e.ikUploadType||"logo"===e.ikUploadType?r:"video"===e.ikUploadType?n:n+r,e.uploader=new t({url:"/api/media",queueLimit:e.queueLimit?e.queueLimit:1,filters:[{name:"mediaFilter",fn:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1);return i.indexOf(t)!==-1}}]}),e.selectFiles=function(){angular.element(document.querySelector("#select-files")).click()},e.clearQueue=function(){e.uploader.clearQueue(),e.uploadComplete=!1,e.uploadErrors=!1,e.currentStep=1,e.uploadErrorText=""},e.removeItem=function(t){t.remove(),e.uploader.queue.length<=0&&(e.currentStep=1,e.uploadComplete=!1,e.uploadErrors=!1)},e.upload=function(){e.uploadInProgress=!0,e.uploader.uploadAll()},e.isImage=function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1);return r.indexOf(t)!==-1},e.getProgress=function(){if(e.uploader.progress)return e.uploadInProgress&&e.uploader.progress>5?e.uploader.progress-5:e.uploader.progress},e.uploader.onAfterAddingFile=function(t){t.formData=[{title:"",logo:!1}],"logo"===e.ikUploadType&&(t.formData[0].logo=!0)},e.uploader.onAfterAddingAll=function(){e.currentStep++},e.uploader.onErrorItem=function(t,n,r){e.uploadErrors=!0,e.uploadInProgress=!1,413===r?e.uploadErrorText="Filen var for stor (fejlkode: 413)":e.uploadErrorText="Der skete en fejl (fejlkode: "+r+")"},e.uploader.onCompleteAll=function(){e.uploadComplete=!0,e.uploadInProgress=!1},e.uploader.onSuccessItem=function(t,n){e.$emit("mediaUpload.uploadSuccess",{image:t,id:n[0],queue:e.uploader.queue})}}],link:function(){},templateUrl:"/app/shared/elements/mediaUpload/media-upload-directive.html?"+window.config.version}}]),function(){"use strict";var e;e=angular.module("ngModal",[]),e.directive("modalDialog",[function(){return{restrict:"E",scope:{show:"=",onClose:"&?"},replace:!0,transclude:!0,link:function(e){e.hideModal=function(){e.show=!1},e.$watch("show",function(t,n){if(t&&!n?document.getElementsByTagName("body")[0].style.overflow="hidden":document.getElementsByTagName("body")[0].style.overflow="",!t&&n&&null!==e.onClose)return e.onClose()})},templateUrl:"app/shared/elements/ngModal/ng-modal.html?"+window.config.version}}])}.call(this),angular.module("ikApp").directive("ikPager",[function(){"use strict";return{restrict:"E",replace:!0,scope:!0,controller:["$scope",function(e){e.pagesFrom=0,e.pagesPerLine=10,e.changePage=function(t){e.pager.page=t,e.updateSearch(),e.pagesFrom=Math.floor(e.pager.page/e.pagesPerLine)*e.pagesPerLine},e.prevPage=function(){e.pager.page>0&&(e.pager.page--,e.updateSearch()),e.pager.page<e.pagesFrom&&(e.pagesFrom=e.pagesFrom-e.pagesPerLine)},e.nextPage=function(){e.pager.page<e.pager.max-1&&(e.pager.page++,e.updateSearch()),e.pager.page===e.pagesFrom+e.pagesPerLine&&(e.pagesFrom=e.pagesFrom+e.pagesPerLine)},e.prevLine=function(){e.pager.page>0&&(e.pager.page=e.pager.page-e.pagesPerLine,e.pager.page<0&&(e.pager.page=0),e.updateSearch()),e.pagesFrom=Math.floor(e.pager.page/e.pagesPerLine)*e.pagesPerLine},e.nextLine=function(){e.pager.page<e.pager.max-1&&(e.pager.page=e.pager.page+e.pagesPerLine,e.pager.page>=e.pager.max&&(e.pager.page=e.pager.max-1),e.updateSearch()),e.pagesFrom=Math.floor(e.pager.page/e.pagesPerLine)*e.pagesPerLine},e.$watch("hits",function(t){var n=[];if(e.pager.max=0,t>e.pager.size){e.pager.max=Math.ceil(t/e.pager.size);for(var r=0;r<e.pager.max;r++)n.push(r)}e.pager.pages=n})}],templateUrl:"/app/shared/elements/pager/pager-directive.html?"+window.config.version}}]),angular.module("ikApp").directive("ikScreen",[function(){"use strict";return{restrict:"E",scope:{ikScreen:"="},link:function(e,t,n){n.$observe("ikScreen",function(t){t&&("landscape"===e.ikScreen.template.orientation?e.style={width:"300px",height:"168.5px"}:e.style={height:"300px",width:"168.5px"})})},templateUrl:"app/shared/elements/screen/screen-template.html?"+window.config.version}}]),angular.module("ikApp").directive("ikSharedChannel",["$interval","$location",function(e,t){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikChannel:"=",ikSingleSlide:"@",ikSharingIndex:"=",ikClickable:"="},link:function(n){n.slideIndex=0,n.playText="",n.$watch("ikChannel",function(e){e&&(n.ikChannel.slides.length<=0?n.templateURL="app/shared/elements/sharedChannel/empty-channel.html?"+window.config.version:(n.templateURL="app/shared/elements/sharedChannel/non-empty-channel.html?"+window.config.version,n.buttonState="play"),n.ikChannel.slides.forEach(function(e){$("head > link[href='"+e.css_path+"']")||$("head").append('<link rel="stylesheet" href="'+e.css_path+'" type="text/css" />')}))}),n.play=function(){angular.isDefined(n.interval)?(e.cancel(n.interval),n.interval=void 0,n.buttonState="play"):(n.slideIndex=(n.slideIndex+1)%n.ikChannel.slides.length,n.interval=e(function(){n.slideIndex=(n.slideIndex+1)%n.ikChannel.slides.length},2e3),n.buttonState="pause")},n.redirectToChannel=function(){n.ikClickable&&t.path("/shared-channel/"+n.ikChannel.unique_id+"/"+n.ikSharingIndex)},n.$on("$destroy",function(){angular.isDefined(n.interval)&&(e.cancel(n.interval),n.interval=void 0)})},templateUrl:"app/shared/elements/sharedChannel/shared-channel-template.html?"+window.config.version}}]),angular.module("ikApp").directive("sharedChannelOverview",["sharedChannelFactory","userFactory","$timeout","busService",function(e,t,n,r){"use strict";return{restrict:"E",scope:{ikSelectedChannels:"=",ikOverlay:"@",ikSingleSlide:"="},link:function(n){n.index={},n.loading=!1,n.pickIndexDialog=!1,n.displaySharingOption=window.config.sharingService.enabled,n.sharingIndexes=[],e.getSharingIndexes().then(function(e){n.sharingIndexes=e}),n.sort={created_at:"desc"},t.getCurrentUser().then(function(e){n.currentUser=e,n.showFromUser=localStorage.getItem("overview.shared_channel.search_filter_default")?localStorage.getItem("overview.shared_channel.search_filter_default"):"all"},function(e){r.$emit("log.error",{cause:e,msg:"Kunne ikke loade bruger"})}),n.pager={size:6,page:0},n.hits=0,n.channels=[];var i={fields:"title",text:"",filter:{bool:{must:{}}},sort:{created_at:{order:"desc"}},pager:n.pager};n.updateSearch=function(){return i.text=n.search_text,angular.isUndefined(n.index.index)?void r.$emit("log.info",{msg:"Du skal vælge et indeks først.",timeout:3e3}):(n.loading=!0,void e.searchChannels(i,n.index.index).then(function(e){n.loading=!1,n.hits=e.hits,n.channels=e.results},function(e){r.$emit("log.error",{cause:e,msg:"Hentning af søgeresultater fejlede."}),n.loading=!1}))},n.$on("channel-deleted",function(){n.updateSearch()}),n.channelSelected=function(e){if(!n.ikSelectedChannels)return!1;var t=!1;return n.ikSelectedChannels.forEach(function(n){n.unique_id==e.unique_id&&(t=!0)}),t},n.clickSharedChannel=function(e,t){n.$emit("channelSharingOverview.clickSharedChannel",e,t)},n.setIndex=function(e){n.index=e,n.pickIndexDialog=!1,n.updateSearch()},n.setUser=function(e){localStorage.setItem("overview.shared_channel.search_filter_default",e),n.showFromUser!==e&&(n.showFromUser=e,n.updateSearch())},n.setSearchFilters=function(){if(delete i.filter,"all"!==n.showFromUser&&(i.filter={bool:{must:[]}}),"all"!==n.showFromUser){var e={};e.term={user:n.currentUser.id},i.filter.bool.must.push(e)}n.updateSearch()},n.setSort=function(e,t){void 0!==n.sort[e]&&n.sort[e]===t||(n.sort={},n.sort[e]=t,i.sort={},i.sort[e]={order:t},n.updateSearch())}},templateUrl:"/app/shared/elements/sharedChannelOverview/shared-channel-overview.html?"+window.config.version}}]),angular.module("ikApp").directive("ikSlideOverview",["busService","$filter",function(e,t){"use strict";return{restrict:"E",scope:{ikSelectedSlides:"=",ikOverlay:"@"},controller:["$scope","slideFactory","userFactory",function(n,r,i){n.loading=!1,n.sort={created_at:"desc"},n.pager={size:6,page:0},n.hits=0,n.slides=[];var o={fields:["title"],text:n.search_text,sort:{created_at:{order:"desc"}},pager:n.pager};n.updateSearch=function(){o.text=n.search_text,n.loading=!0,r.searchSlides(o).then(function(t){n.hits=t.hits;for(var i=[],o=0;o<t.results.length;o++)i.push(t.results[o].id);r.loadSlidesBulk(i).then(function(e){n.slides=e,n.loading=!1},function(t){e.$emit("log.error",{cause:t,msg:"Hentning af søgeresultater fejlede."}),n.loading=!1})})},n.$on("slide-deleted",function(e){n.updateSearch()}),n.setUser=function(e){localStorage.setItem("overview.slide.search_filter_default",e),n.showFromUser!==e&&(n.showFromUser=e,n.setSearchFilters())},n.setSearchFilters=function(){if(delete o.filter,"all"!==n.showFromUser&&(o.filter={bool:{must:[]}}),"all"!==n.showFromUser){var e={};e.term={user:n.currentUser.id},o.filter.bool.must.push(e)}n.updateSearch()},n.slideSelected=function(e){if(!n.ikSelectedSlides)return!1;var t=!1;return n.ikSelectedSlides.forEach(function(n,r){n.id==e.id&&(t=!0)}),t},n.outOfSchedule=function(e){return!(!e.schedule_from||!e.schedule_to)&&!(1e3*e.schedule_from<Date.now()&&1e3*e.schedule_to>Date.now())},n.setSort=function(e,t){void 0!==n.sort[e]&&n.sort[e]===t||(n.sort={},n.sort[e]=t,o.sort={},o.sort[e]={order:t},n.updateSearch())},n.slideOverviewClickSlide=function(e){n.$emit("slideOverview.clickSlide",e)},n.slideScheduledNow=function(e){if(!e.published)return!1;var t=new Date;return t=parseInt(t.getTime()/1e3),!(e.hasOwnProperty("schedule_from")&&t<e.schedule_from)&&!(e.hasOwnProperty("schedule_to")&&t>e.schedule_to)},n.getScheduledText=function(e){var n="";return e.published||(n+="Ikke udgivet!<br/>"),e.hasOwnProperty("schedule_from")&&(n=n+"Udgivet fra: "+t("date")(1e3*e.schedule_from,"dd/MM/yyyy HH:mm")+".<br/>"),e.hasOwnProperty("schedule_to")&&(n=n+"Udgivet til: "+t("date")(1e3*e.schedule_to,"dd/MM/yyyy HH:mm")+"."),n},i.getCurrentUser().then(function(e){n.currentUser=e,n.showFromUser=localStorage.getItem("overview.slide.search_filter_default")?localStorage.getItem("overview.slide.search_filter_default"):"all",n.setSearchFilters()})}],templateUrl:"/app/shared/elements/slideOverview/slide-overview-directive.html?"+window.config.version}}]),angular.module("ikApp").directive("ikSharedSlide",[function(){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikSlide:"="},link:function(e,t,n){e.templateURL="/app/shared/elements/slide/slide-loading.html?"+window.config.version,n.$observe("ikSlide",function(t){t&&(e.ikSlide.media_thumbs&&e.ikSlide.media_thumbs.length>0&&(e.ikSlide.currentImage=e.ikSlide.media_thumbs[0]),e.ikSlide.currentLogo=e.ikSlide.logo,e.templateURL=e.ikSlide.preview_path,e.theStyle={width:""+e.ikWidth+"px",height:""+parseFloat(1080*parseFloat(e.ikWidth/1920))+"px"},e.ikSlide.options.fontsize&&(e.theStyle.fontsize=""+parseFloat(e.ikSlide.options.fontsize*parseFloat(e.ikWidth/1920))+"px"))})},template:'<div class="preview--slide" data-ng-include="" src="templateURL"></div>'}}]),angular.module("ikApp").directive("ikSlide",["slideFactory","templateFactory","busService",function(e,t,n){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikSlide:"="},link:function(e,r,i){e.templateURL="/app/shared/elements/slide/slide-loading.html?"+window.config.version,i.$observe("ikSlide",function(r){r&&("image"===e.ikSlide.media_type?e.ikSlide.media.length>0?e.ikSlide.currentImage=e.ikSlide.media[0].urls.default_landscape_small:e.ikSlide.currentImage="":e.ikSlide.media.length>0&&e.ikSlide.media[0].provider_metadata.length>0&&e.ikSlide.media[0].provider_metadata[0].thumbnails&&e.ikSlide.media[0].provider_metadata[0].thumbnails.length>0?e.ikSlide.currentImage=e.ikSlide.media[0].provider_metadata[0].thumbnails[1].reference:e.ikSlide.currentImage="",void 0!==e.ikSlide.logo&&null!==e.ikSlide.logo?e.ikSlide.currentLogo=e.ikSlide.logo.urls.default_landscape:e.ikSlide.currentLogo="",t.getSlideTemplate(e.ikSlide.template).then(function(t){e.template=t,e.templateURL=e.template.paths.preview,e.theStyle={width:""+e.ikWidth+"px",height:""+parseFloat(e.template.ideal_dimensions.height*parseFloat(e.ikWidth/e.template.ideal_dimensions.width))+"px"},e.ikSlide.options.fontsize&&(e.theStyle.fontsize=""+parseFloat(e.ikSlide.options.fontsize*parseFloat(e.ikWidth/e.template.ideal_dimensions.width))+"px")},function(e){n.$emit("log.error",{cause:e,msg:"Hentning af templates fejlede."})}))})},template:'<div class="preview--slide" data-ng-style="{\'width\': theStyle.width}" data-ng-include="" src="templateURL"></div>'}}]),angular.module("ikApp").directive("ikSlideEditable",["templateFactory","busService",function(e,t){"use strict";return{restrict:"E",scope:{ikWidth:"@",ikSlide:"="},link:function(n,r,i){n.templateURL="/app/shared/elements/slide/slide-loading.html?"+window.config.version,n.$watch("ikSlide",function(i,o){i&&("image"===n.ikSlide.media_type?(n.ikSlide.currentImage="",n.ikSlide.media.length>0&&(n.ikSlide.currentImage=n.ikSlide.media[0].urls.default_landscape)):"video"===n.ikSlide.media_type&&(n.ikSlide.currentVideo={mp4:"",ogg:"",webm:""},n.ikSlide.media.length>0&&void 0!==n.ikSlide.media[0]&&(n.ikSlide.media.length>0&&n.ikSlide.media[0].provider_metadata.length>0&&(n.ikSlide.currentVideo={},n.ikSlide.media[0].provider_metadata[0]&&(n.ikSlide.currentVideo.mp4=n.ikSlide.media[0].provider_metadata[0].reference),n.ikSlide.media[0].provider_metadata[1]&&(n.ikSlide.currentVideo.ogg=n.ikSlide.media[0].provider_metadata[1].reference),n.ikSlide.media[0].provider_metadata[2]&&(n.ikSlide.currentVideo.webm=n.ikSlide.media[0].provider_metadata[2].reference)),setTimeout(function(){r.find("#videoPlayer").load()},1e3))),n.ikSlide.currentLogo="",void 0!==n.ikSlide.logo&&null!==n.ikSlide.logo&&(n.ikSlide.currentLogo=n.ikSlide.logo.urls.default_landscape),n.template&&i.template===o.template||e.getSlideTemplate(n.ikSlide.template).then(function(e){n.template=e,n.templateURL=n.template.paths.edit,n.theStyle={width:""+n.ikWidth+"px",height:""+parseFloat(n.template.ideal_dimensions.height*parseFloat(n.ikWidth/n.template.ideal_dimensions.width))+"px",fontsize:""+parseFloat(n.ikSlide.options.fontsize*parseFloat(n.ikWidth/n.template.ideal_dimensions.width))+"px"}},function(e){t.$emit("log.error",{cause:e,msg:"Hentning af templates fejlede."})}),n.theStyle&&(n.theStyle.fontsize=""+parseFloat(n.ikSlide.options.fontsize*parseFloat(n.ikWidth/n.template.ideal_dimensions.width))+"px"))},!0)},templateUrl:"/app/shared/elements/slide/slide-edit.html?"+window.config.version}}]),angular.module("ikApp").directive("ikThumb",["$window",function(e){"use strict";var t={support:!(!e.FileReader||!e.CanvasRenderingContext2D),isFile:function(t){return angular.isObject(t)&&t instanceof e.File},isImage:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1);return"|jpg|png|jpeg|bmp|gif|".indexOf(t)!==-1}};return{restrict:"A",template:"<canvas/>",link:function(e,n,r){function i(e){var t=new Image;t.onload=o,t.src=e.target.result}function o(){var e=a.width?a.width:this.width/this.height*a.height,t=a.height?a.height:this.height/this.width*a.width;l.attr({width:e,height:t}),l[0].getContext("2d").drawImage(this,0,0,e,t)}if(t.support){var a=e.$eval(r.ikThumb);if(t.isFile(a.file)&&t.isImage(a.file)){var l=n.find("canvas"),s=new FileReader;s.onload=i,s.readAsDataURL(a.file)}}}}}]),function(){"use strict";var e;e=angular.module("itkChannelPickerWidget",[]),e.directive("channelPickerWidget",["userFactory","channelFactory","busService",function(e,t,n){return{restrict:"E",replace:!0,templateUrl:"app/shared/widgets/channelPickerWidget/channel-picker-widget.html?"+window.config.version,scope:{screen:"=",region:"="},link:function(r){r.sharingEnabled=window.config.sharingService.enabled,r.loading=!1,r.showFromUser="all",r.sort={created_at:"desc"},e.getCurrentUser().then(function(e){r.currentUser=e},function(e){n.$emit("log.error",{cause:e,msg:"Kunne ikke hente bruger."})}),r.pager={size:5,page:0},r.hits=0,r.channels=[];var i={fields:"title",text:"",filter:{bool:{must:[]}},sort:{created_at:{order:"desc"}},pager:r.pager};r.updateSearch=function(){i.text=r.search_text,r.loading=!0,t.searchChannels(i).then(function(e){r.hits=e.hits;for(var i=[],o=0;o<e.results.length;o++)i.push(e.results[o].id);t.loadChannelsBulk(i).then(function(e){r.channels=e,r.loading=!1},function(e){n.$emit("log.error",{cause:e,msg:"Kunne ikke hente søgeresultater."}),r.loading=!1})})},r.channelSelected=function(e){for(var t,n=0;n<r.screen.channel_screen_regions.length;n++)if(t=r.screen.channel_screen_regions[n],t.channel&&t.channel.id===e.id&&t.region===r.region)return!0;return!1},r.addChannel=function(e){r.screen.channel_screen_regions.push({id:null,screen_id:r.screen.id,channel:e,region:r.region})},r.removeChannel=function(e){for(var t,n=0;n<r.screen.channel_screen_regions.length;n++)t=r.screen.channel_screen_regions[n],t.channel&&t.channel.id===e.id&&t.region===r.region&&r.screen.channel_screen_regions.splice(n,1)},r.$watch("screen",function(e){e&&r.updateSearch()})}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkChannelRemoverWidget",[]),e.directive("channelRemoverWidget",[function(){return{restrict:"E",replace:!0,templateUrl:"app/shared/widgets/channelRemoverWidget/channel-remover-widget.html?"+window.config.version,scope:{screen:"=",region:"="},link:function(e){e.search_text="",e.getSearch=function(){return{title:e.search_text}},e.removeChannel=function(t){for(var n,r=0;r<e.screen.channel_screen_regions.length;r++)n=e.screen.channel_screen_regions[r],void 0===n.shared_channel&&n.channel.id===t.id&&n.region===e.region?e.screen.channel_screen_regions.splice(r,1):n.shared_channel&&n.shared_channel.unique_id===t.unique_id&&n.region===e.region&&e.screen.channel_screen_regions.splice(r,1)}}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkNumberWidget",[]),e.directive("numberWidget",function(){return{restrict:"E",scope:{field:"=",placeholderText:"@"},replace:!0,template:'<input type="number" class="cpw--text-input" placeholder="{{placeholderText}}" data-ng-model="field">'}})}.call(this),function(){"use strict";var e;e=angular.module("itkRegionPreviewWidget",[]),e.directive("regionPreviewWidget",[function(){return{restrict:"E",scope:{region:"=",screen:"=",width:"="},replace:!1,templateUrl:"app/shared/widgets/regionPreviewWidget/region-preview-widget.html?"+window.config.version,link:function(e){e.getNumberOfChannels=function(){for(var t=0,n=0;n<e.screen.channel_screen_regions.length;n++)e.screen.channel_screen_regions[n].region===e.region&&t++;
return t}}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkScreenTemplatePickerWidget",[]),e.directive("screenTemplatePickerWidget",["templateFactory","busService",function(e,t){return{restrict:"E",scope:{screen:"="},replace:!0,link:function(n){n.templates=[],e.getScreenTemplates().then(function(e){n.templates=e},function(e){t.$emit("log.error",{cause:e,msg:"Kunne ikke loade templates."})}),n.pickTemplate=function(e){n.screen.template=angular.copy(e)}},templateUrl:"app/shared/widgets/screenTemplatePickerWidget/screenTemplatePickerWidget.html?"+window.config.version}}])}.call(this),function(){"use strict";var e;e=angular.module("itkSharedChannelPickerWidget",[]),e.directive("sharedChannelPickerWidget",["sharedChannelFactory","busService",function(e,t){return{restrict:"E",replace:!0,templateUrl:"app/shared/widgets/sharedChannelPickerWidget/shared-channel-picker-widget.html?"+window.config.version,scope:{screen:"=",region:"="},link:function(n,r,i){n.index=null,n.loading=!1,n.pickIndexDialog=!1,n.sharingIndexes=[],e.getSharingIndexes().then(function(e){n.sharingIndexes=e},function(e){t.$emit("log.error",{cause:e,msg:"Kunne ikke hente delingsindeks."})}),n.showFromUser="all",n.sort={created_at:"desc"},n.pager={size:9,page:0},n.hits=0,n.channels=[];var o={fields:"title",text:"",filter:{bool:{must:[]}},sort:{created_at:{order:"desc"}},pager:n.pager};n.updateSearch=function(){null!==n.index&&(o.text=n.search_text,n.loading=!0,e.searchChannels(o,n.index.index).then(function(e){n.loading=!1,n.hits=e.hits,n.channels=e.results},function(e){t.$emit("log.error",{cause:e,msg:"Kunne ikke hente søgeresultater."}),n.loading=!1}))},n.setIndex=function(e){n.index=e,n.pickIndexDialog=!1,n.updateSearch()},n.channelSelected=function(e){for(var t,r=0;r<n.screen.channel_screen_regions.length;r++)if(t=n.screen.channel_screen_regions[r],t.shared_channel&&t.shared_channel.unique_id===e.unique_id&&t.region===n.region)return!0;return!1},n.addChannel=function(e){void 0!==e.index&&null!==e.index||(e.index=n.index.index),n.screen.channel_screen_regions.push({id:null,screen_id:n.screen.id,shared_channel:e,region:n.region})},n.removeChannel=function(e){for(var t,r=0;r<n.screen.channel_screen_regions.length;r++)t=n.screen.channel_screen_regions[r],t.shared_channel&&t.shared_channel.unique_id===e.unique_id&&t.region===n.region&&n.screen.channel_screen_regions.splice(r,1)},i.$observe("screen",function(e){e&&n.updateSearch()})}}}])}.call(this),function(){"use strict";var e;e=angular.module("itkTextWidget",[]),e.directive("textWidget",function(){return{restrict:"E",scope:{field:"=",placeholderText:"@"},replace:!0,template:'<input type="text" class="cpw--text-input" placeholder="{{placeholderText}}" data-ng-model="field">'}})}.call(this),function(){"use strict";var e;e=angular.module("itkTextAreaWidget",[]),e.directive("textAreaWidget",function(){return{restrict:"E",scope:{field:"=",placeholderText:"@"},replace:!0,template:'<textarea class="cpw--textarea-input" data-ng-model="field" placeholder="{{placeholderText}}"></textarea>'}})}.call(this);